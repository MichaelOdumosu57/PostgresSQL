

need driver, endpoint, backing up db,  converting to csv

to convert to csv
first give postgres write access to desired directory
COPY accounts TO '/home/uoul/My_Computer/Database_Folder/PostgreSQL/homefile_name.csv' DELIMITER ',' CSV HEADER;
https://tableplus.io/blog/2018/04/postgresql-how-to-export-table-to-csv-file-with-header.html
ready COPY on page 1555

need 18 19 20
20 conatins endpoint 21 contains user info

    ENDPOINT
might use creating certificates in 18.9 to  set  up the connectiom
so in
SELECT * FROM pg_settings WHERE  name = 'listen_addresses';
you must modify this to allow for all IPv4 incoming connections and properly restart the server


listen_addresses(enum) set this to 0.0.0.0

update
client_min_messages (enum)  and make this DEBUG5

BACKUP
25,27 contains backup

to backup your database
pg_dumpall > outputfile

might need 21

https://wiki.postgresql.org/wiki/List_of_drivers   contains driver
https://node-postgres.com/




when using several operators refer to the operator precedence table in mydb/operator_precendence

http://www.heartnsoul.com/ascii_art/elephants.txt
               _..--""-.                  .-""--.._
           _.-'         \ __...----...__ /         '-._
         .'      .:::...,'              ',...:::.      '.
        (     .'``'''::;                  ;::'''``'.     )
         \             '-)              (-'             /
          \             /                \             /
           \          .'.-.            .-.'.          /
            \         | \0|            |0/ |         /
            |          \  |   .-==-.   |  /          |
             \          `/`;          ;`\`          /
              '.._      (_ |  .-==-.  | _)      _..'
                  `"`"-`/ `/'        '\` \`-"`"`
                       / /`;   .==.   ;`\ \
                 .---./_/   \  .==.  /   \ \
                / '.    `-.__)       |    `"
               | =(`-.        '==.   ;
                \  '. `-.           /
                 \_:_)   `"--.....-'

POSTGRES sql

table

 Full secton
                          _.-----.._____,-~~~~-._...__
                          ,-'            /         `....
                        ,'             ,'      .  .  \::.
                      ,'        . ''    :     . \  `./::..
                    ,'    ..   .     .      .  . : ;':::.
                   /     :go. :       . :    \ : ;'.::.
                   |     ' .o8)     .  :|    : ,'. .
                  /     :   ~:'  . '   :/  . :/. .
                 /       ,  '          |   : /. .
                /       ,              |   ./.
                L._    .       ,' .:.  /  ,'.
               /-.     :.--._,-'~~~~~~| ,'|:
              ,--.    /   .:/         |/::| `.
              |-.    /   .;'      .-__)::/    \
 ...._____...-|-.  ,'  .;'      .' '.'|;'      |
   ~--..._____\-_-'  .:'      .'   /  '
    ___....--~~   _.-' `.___.'   ./
      ~~------+~~_. .    ~~    .,'
                  ~:_.' . . ._:'
                     ~~-+-+~~


chapter
           .-~~-. .--.
          /      /   "\
         /    \ |  \   \
        |/\    | \_/-'\ \
        A |   /  ||   /_/
          |__||__||
         /~~~~~~~~~~\
        /\_/\_/\_/\_/\
       /\/ \/ \/ \/ \/\
    __/________________\__



subsecton
           _    _
          / \__/ \_____
         /  /  \  \    `\
         )  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'

bullet point
     ___.---.___
   .'  (     )  '.
   )   /)' '(    )
   ',_( ';-;'\_,'
         |-|
         (")


link
        ____
       /.   \__
      /_  \_/  \
     // \  ___ |\
        |_| |_|


tip
                      _    _
                     /=\""/=\
                    (=(0_0 |=)__
                     \_\ _/_/   )
                       /_/   _  /\
                      |/ |\ || |
                         ~ ~  ~




                          _.-----.._____,-~~~~-._...__
                          ,-'            /         `....
                        ,'             ,'      .  .  \::.
   what is            ,'        . ''    :     . \  `./::..
    POSTGRES        ,'    ..   .     .      .  . : ;':::.
     and history   /     :go. :       . :    \ : ;'.::.
                   |     ' .o8)     .  :|    : ,'. .
                  /     :   ~:'  . '   :/  . :/. .
                 /       ,  '          |   : /. .
                /       ,              |   ./.
                L._    .       ,' .:.  /  ,'.
               /-.     :.--._,-'~~~~~~| ,'|:
              ,--.    /   .:/         |/::| `.
              |-.    /   .;'      .-__)::/    \
 ...._____...-|-.  ,'  .;'      .' '.'|;'      |
   ~--..._____\-_-'  .:'      .'   /  '
    ___....--~~   _.-' `.___.'   ./
      ~~------+~~_. .    ~~    .,'
                  ~:_.' . . ._:'
                     ~~-+-+~~

An ORDBMS was the early verison of databases from Berkeley
it offers a lot and it can be exteneded by the user
upgrades to it were foucused on portability and reliablitiy
then came postgres95

use the wiki, web site for latest info mailing list  and yourself to learn more about postgres



                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
5 Reporting bugs    |/\    | \_/-'\ \
                    A |   /  ||   /_/
                      |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__
                    
there are bug reporting guidelines to follow


           _    _
          / \__/ \_____
         /  /  \  \    `\
5.1      )  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'
    
if from documentation you cannot understand send the bug and the documenatation



           _    _
          / \__/ \_____
         /  /  \  \    `\
5.2      )  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'

state only facts not what you think went wrong
set  psql, say \set VERBOSITY verbose beforehand
from server log run-time parameter log_error_verbosity to verbose

SELECT version(); finds version running be specific where the problem is


           _    _
          / \__/ \_____
         /  /  \  \    `\
5.3      )  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'

send bugs to
<pgsql-bugs@lists.postgresql.org>


                          _.-----.._____,-~~~~-._...__
                          ,-'            /         `....
                        ,'             ,'      .  .  \::.
    getting started   ,'        . ''    :     . \  `./::..
    POSTGRES        ,'    ..   .     .      .  . : ;':::.
     and history   /     :go. :       . :    \ : ;'.::.
                   |     ' .o8)     .  :|    : ,'. .
                  /     :   ~:'  . '   :/  . :/. .
                 /       ,  '          |   : /. .
                /       ,              |   ./.
                L._    .       ,' .:.  /  ,'.
               /-.     :.--._,-'~~~~~~| ,'|:
              ,--.    /   .:/         |/::| `.
              |-.    /   .;'      .-__)::/    \
 ...._____...-|-.  ,'  .;'      .' '.'|;'      |
   ~--..._____\-_-'  .:'      .'   /  '
    ___....--~~   _.-' `.___.'   ./
      ~~------+~~_. .    ~~    .,'
                  ~:_.' . . ._:'
                     ~~-+-+~~

                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
Installation        |/\    | \_/-'\ \
                    A |   /  ||   /_/
                      |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__
                    

dont need root to install it
go to chapter 16 on how to install it


                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
Architectural       |/\    | \_/-'\ \
Fundamentals        A |   /  ||   /_/
                      |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__
                    

client-server model
server process - manages database files,
accepts connections to database
perform actions for client
known as postgres

the client wants things to be done and could be anything

if the client and server are on differnt hosts they need a TCP/IP network connection

the postgres daemon handles multiple connections by forking a child server process for each incoming client process


                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
  Installation      |/\    | \_/-'\ \
from package        A |   /  ||   /_/
manager  Database     |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__

if using a package manager refer to it




        ____
       /.   \__
      /_  \_/  \   https://tecadmin.net/install-postgresql-server-on-ubuntu/
     // \  ___ |\
      snd|_| |_|



Adding user postgres to group ssl-cert

Creating config file /etc/postgresql-common/createcluster.conf with new version
Building PostgreSQL dictionaries from installed myspell/hunspell packages...
  en_us
Removing obsolete dictionary files:
Setting up postgresql-11 (11.3-1.pgdg16.04+1) ...
Creating new PostgreSQL cluster 11/main ...
/usr/lib/postgresql/11/bin/initdb -D /var/lib/postgresql/11/main --auth-local peer --auth-host md5
The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The database cluster will be initialized with locale "en_US.UTF-8".
The default database encoding has accordingly been set to "UTF8".
The default text search configuration will be set to "english".

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/postgresql/11/main ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

Success. You can now start the database server using:

    


Ver Cluster Port Status Owner    Data directory              Log file
11  main    5432 down   postgres /var/lib/postgresql/11/main /var/log/postgresql/postgresql-11-main.log
update-alternatives: using /usr/share/postgresql/11/man/man1/postmaster.1.gz to provide /usr/share/man/man1/postmaster.1.gz (postmaster.1.gz) in auto mode
Setting up postgresql (11+201.pgdg16.04+1) ...



to access postgres

sudo su - postgres
psql

to learn about basic connection to postgres
\conninfo

to quit
\q



                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
  Creating          |/\    | \_/-'\ \
    A               A |   /  ||   /_/
 Database             |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__



to create
https://www.liquidweb.com/kb/creating-and-deleting-a-postgresql-database/
CREATE DATABASE [dbname;]
    no response sucesss
    command not found: use  /usr/local/pgsql/bin/createdb mydb absolute path
    more problems refer to page 43 in handbook
     Database names must have an alphabetic first character and are limited to 63 bytes in length.

to destroy
    DROP DATABASE [dbname;]
    irrecoverable

to conect
    \c [dbname;]


                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
1.4  Accessing      |/\    | \_/-'\ \
    A               A |   /  ||   /_/
 Database             |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__

you can use psql console, a GUI like pgAdmin or writing your own that works with the protocol

psql mydb  (doesnt work)
 
as postgres
pg_ctlcluster 11 main start
its already running

SELECT version();
SELECT current_date;
SELECT 2 + 2;

if a command start with a  \ its a psql only command

\h for SQL help
\? for internal commands
\q to quit


                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
2  The SQL           |/\    | \_/-'\ \
    language         A |   /  ||   /_/
                       |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__


what postgres has is a modified extension


           _    _
          / \__/ \_____
concepts /  /  \  \    `\
         )  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'

its a RDBMS
relation is a math word for table

SQL does not gurantee the order of tables in any way
tables are grouped to databases to a databease cluster managerd byh one postgres server


           _    _
          / \__/ \_____
create a /  /  \  \    `\
new table)  \''/  (     |\
         `\__)/__/'_\  / `
            //_|_|~|_|_|
            ^""'"' ""'"'


CREATE TABLE weather (
 city       varchar(80),
 temp_lo    int,         -- low temperature
 temp_hi    int,         -- high temperature
 prcp       real,         -- precipitation
 date       date
);


CREATE TABLE noop (
 city       varchar(80),
 temp_lo    int,         -- low temperature
 temp_hi    int,         -- high temperature
 prcp       real,         -- precipitation
 date       date
);


you can create this with line breaks just dont use semil colon
the first column is name second is data type -- is used for comments


CREATE TABLE cities (
 name       varchar(80),
 location    point
);

point is a psql only datatype

to remove a table
DROP TABLE tablename;



              _    _
             / \__/ \_____
 populate   /  /  \  \    `\
table       )  \''/  (     |\
            `\__)/__/'_\  / `
               //_|_|~|_|_|
              ^""'"' ""'"'

insert statement is used to fill a table

INSERT INTO weather VALUES ('San Francisco', 46, 50, 0.25,
 '1994-11-27');

constants that are not simple number must be surrounded by a single quote
point type  wants a coordinate pair
date accepts many formats

to specify the columns of the table

INSERT INTO weather (city, temp_lo, temp_hi, prcp, date)
 VALUES ('San Francisco', 43, 57, 0.0, '1994-11-29');

use the COPY command for more effeciency

COPY weather FROM '/home/user/weather.txt';


COPY my_table TO 'file_name.csv' DELIMITER ',' CSV HEADER;
              _    _
             / \__/ \_____
 querying   /  /  \  \    `\
table       )  \''/  (     |\
            `\__)/__/'_\  / `
               //_|_|~|_|_|
              ^""'"' ""'"'
use SELECT
to select everything
SELECT * FROM weather;

to write expressions
SELECT city, (temp_hi+temp_lo)/2 AS temp_avg, date FROM weather;
this results in working with the data to produce more meaningful things to your app lookng the 2nd expression

AS  is used to relabel the output column, optional







             ___.---.___
           .'  (     )  '.
WHERE      )   /)' '(    )
           ',_( ';-;'\_,'
                 |-|
                 (")

to specifiy specific quotes from a string

to make conditionals
SELECT * FROM weather
 WHERE city = 'San Francisco' AND prcp > 0.0;


to sort use ORDER
SELECT * FROM weather
 ORDER BY city;

    if they happen to have the same name but thats not the order you want get more columns involved in the SQL command
    SELECT * FROM weather
     ORDER BY city, temp_lo;

to avoid duplcate rows

SELECT DISTINCT city, temp_hi
 FROM weather;

    but if this kicks out what you want use combos until Postgres understands to keep it



                         _    _
                        / \__/ \_____
    joins between      /  /  \  \    `\
table                  )  \''/  (     |\
                       `\__)/__/'_\  / `
                          //_|_|~|_|_|
                         ^""'"' ""'"'

if a query works with more than one table its a join

SELECT city, temp_lo, temp_hi, prcp, date, location
    FROM weather, cities
    WHERE city = name;


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     if a index in not availbe in one of the rows of the table join
       /_/   _  /\      the join query fills it with the previous index. this gets messy
       |/ |\ || |
         ~ ~  ~

                   ___.---.___
                 .'  (     )  '.
INNER JOIN       )   /)' '(    )
                 ',_( ';-;'\_,'
                       |-|
                       (")


SELECT *
 FROM weather INNER JOIN cities ON (weather.city = cities.name);
some times you need to specify whats going on to make your joins cleaner, this is know as qualifying

SELECT weather.city, weather.temp_lo, weather.temp_hi,
    weather.prcp, weather.date, cities.location
    FROM weather, cities
    WHERE cities.name = weather.city;


                   ___.---.___
                 .'  (     )  '.
OUTER JOIN       )   /)' '(    )
                 ',_( ';-;'\_,'
                       |-|
                       (")

when you need empty values where they belong in join statements

SELECT * FROM weather LEFT OUTER JOIN cities ON (weather.city =
 cities.name);

LEFT OUTER JOINS is when the table is on the left of the join,


                   ___.---.___
                 .'  (     )  '.
SELF JOIN        )   /)' '(    )
                 ',_( ';-;'\_,'
                       |-|
                       (")

joining a table against itself, done for calcuations amongst in the table


SELECT W1.city, W1.temp_lo AS low, W1.temp_hi AS high,
 W2.city, W2.temp_lo AS low, W2.temp_hi AS high
 FROM weather W1, weather W2
 WHERE W1.temp_lo < W2.temp_lo
 AND W1.temp_hi > W2.temp_hi;

the tables are relabed in FROM
seen frequently


SELECT W1.city, W1.temp_lo AS lowest, W1.temp_hi AS highest,
    W2.city, W2.temp_lo AS low, W2.temp_hi AS high
    FROM weather W1, weather W2
    WHERE W1.temp_lo < W2.temp_lo
    AND W1.temp_hi > W2.temp_hi;


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    this is like a double loop for every iter in the table, a second iteration is done
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    you will see plenty of table abbreviation in SQL programming
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~


                         _    _
                        / \__/ \_____
    aggregate          /  /  \  \    `\
    functions          )  \''/  (     |\
                       `\__)/__/'_\  / `
                          //_|_|~|_|_|
                         ^""'"' ""'"'

 An aggregate
function computes a single result from multiple input rows

to know what city this is related to use subquery

SELECT city FROM weather
 WHERE temp_lo = (SELECT max(temp_lo) FROM weather);





using GROUP BY properly elimates unwanted items
SELECT city, max(temp_lo)
 FROM weather
 GROUP BY city;


use having when you need to return a bool from the comparison of the result of an aggregate function with
another item becuase it does not return the item it retruns bool


SELECT city, max(temp_lo) < 40
 FROM weather
 GROUP BY city
 HAVING max(temp_lo) < 40;

if you want names beginning with S


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   aggregate functions must be used with HAVING and not with WHERE,that the difference
       /_/   _  /\  that expains why can use them tehre
       |/ |\ || |
         ~ ~  ~


                         _    _
                        / \__/ \_____
    Updates            /  /  \  \    `\
    functions          )  \''/  (     |\
                       `\__)/__/'_\  / `
                          //_|_|~|_|_|
                         ^""'"' ""'"'

how you change items in a table

UPDATE weather
 SET temp_hi = temp_hi - 2, temp_lo = temp_lo - 2
 WHERE date > '1994-11-28';


                         _    _
                        / \__/ \_____
    Deletions          /  /  \  \    `\
    functions          )  \''/  (     |\
                       `\__)/__/'_\  / `
                          //_|_|~|_|_|
                         ^""'"' ""'"'


to delete a row
DELETE FROM weather WHERE city = 'Hayward';

DELETE from tablename
it goes and empties the table the table
]




                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
3  Advanced          |/\    | \_/-'\ \
    Features         A |   /  ||   /_/
                       |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__


               _    _
              / \__/ \_____
3.1 concepts /  /  \  \    `\
             )  \''/  (     |\
             `\__)/__/'_\  / `
                //_|_|~|_|_|
                ^""'"' ""'"'

making management easier and prevent data loss/corrpution


               _    _
              / \__/ \_____
3.2 views    /  /  \  \    `\
             )  \''/  (     |\
             `\__)/__/'_\  / `
                //_|_|~|_|_|
                ^""'"' ""'"'

view - a variable that holds a SQL query and acts as a table

CREATE VIEW myview AS
    SELECT city, temp_lo, temp_hi, prcp, date, location
    FROM weather, cities
    WHERE city = name;

SELECT * FROM myview;


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   use views a lot database developers love that, also use views on views, very efficient
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~


               _    _
              / \__/ \_____
3.3 foreign  /  /  \  \    `\
    keys     )  \''/  (     |\
             `\__)/__/'_\  / `
                //_|_|~|_|_|
                ^""'"' ""'"'

sometimes between two related tables you want to make sure if there is something meaningful in the first table that is used for the second table its there in the first table or it cant be added to the second table

in database mydb

CREATE TABLE cities (
    city varchar(80) primary key,
    location point
);


CREATE TABLE weather (
    city varchar(80) references cities(city),
    temp_lo int,
    temp_hi int,
    prcp real,
    date date
);

so  that doing this

INSERT INTO weather VALUES ('Berkeley', 45, 53, 0.0, '1994-11-28');

wont work

refer to ch 5 for more info



                   _    _
                  / \__/ \_____
3.4 transactions /  /  \  \    `\
                 )  \''/  (     |\
                 `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'


they convert everything into one step and if something fails, it does not ruin your database.
IT HAPPENS COMPLETELY OR NOT AT ALL

also makes sure that the transaction is 100% logged on permanent storage in order to be complete

also  multiple transactions cannot see what each other is doing, they just have the database before it was touched by another transaction and after

in PostgreSQL its done like this

ex
 -------------------------------------------------------------------------
INSERT INTO cities (city, location)
    VALUES ('San Francisco', '(193,27)');
BEGIN;
    INSERT INTO cities (city, location)
        VALUES ('Berkeley', '(221,5)');
    DELETE FROM cities WHERE city = 'San Francisco';
    INSERT INTO weather VALUES ('Berkeley', 45, 53, 0.0, '1994-11-28');
    INSERT INTO weather VALUES ('Jayton', 45, 53, 0.0, '1994-11-28');
COMMIT;
it fails because Jayton is not in city for cities

 -------------------------------------------------------------------------

                  ___.---.___
                 .'  (     )  '.
ROLLBACKS        )   /)' '(    )
                 ',_( ';-;'\_,'
                       |-|
                       (")

say if partway a SQL query fulfills a conditional we can use ROLLBACK instead of commit, and all updated are canceled


ex
 -------------------------------------------------------------------------
INSERT INTO cities (city, location)
    VALUES ('San Francisco', '(193,27)');
BEGIN;
    INSERT INTO cities (city, location)
        VALUES ('Berkeley', '(221,5)');
    DELETE FROM cities WHERE city = 'San Francisco';
ROLLBACK;
    INSERT INTO weather VALUES ('San Francisco', 45, 53, 0.0, '1994-11-28');


it rolls back say we dont want San Francisco to be deleted from our cities, also Berkeley is not
included in cities

 -------------------------------------------------------------------------

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   in postgres every sql query is wrapped in its own tranaction
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~



                   ___.---.___
                 .'  (     )  '.
SAVEPOINTS       )   /)' '(    )
                 ',_( ';-;'\_,'
                       |-|
                       (")

this is how you selectively keep parts of a transaction
put SAVEPOINT at the end of a SQL query, and rollback with ROLLBACK TO;

INSERT INTO cities (city, location)
    VALUES ('San Francisco', '(193,27)');

ex
--------------------------------------------------
CREATE TABLE accounts(
 name       varchar(80),
 balance    float
);

INSERT INTO  accounts (name, balance)
    VALUES ('Alice', 700.00),('Bob', 900.00),('Wally', 200.00);

BEGIN;

UPDATE accounts SET balance = balance - 100.00
 WHERE name = 'Alice';
SAVEPOINT my_savepoint;
UPDATE accounts SET balance = balance + 100.00
 WHERE name = 'Bob';
-- oops ... forget that and use Wally's account
ROLLBACK TO my_savepoint;
UPDATE accounts SET balance = balance + 100.00
 WHERE name = 'Wally';
COMMIT;
-------------------------------------------------------


                   _    _
                  / \__/ \_____
3.5 window       /  /  \  \    `\
    functions    )  \''/  (     |\
                 `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'

 window function performs a calculation across a set of table rows that are somehow related to the current
row. but unlike aggregate functions, the rows are not grouped into a single output

have to learn about this later cannot find an example





                   _    _
                  / \__/ \_____
3.6 inheritance  /  /  \  \    `\
                 )  \''/  (     |\
                 `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'


to copy a table without having it linked like a js object
http://www.postgresqltutorial.com/postgresql-copy-table/

ann implementation of OOP, best way to think of it javascript class extensions


database: inheritance

CREATE TABLE cities (
    name text,
    population real,
    altitude int -- (in ft)
);
CREATE TABLE capitals (
    state char(2)
) INHERITS (cities);





                          _.-----.._____,-~~~~-._...__
                          ,-'            /         `....
                        ,'             ,'      .  .  \::.
    The SQL language   ,'        . ''    :     . \  `./::..
                      ,'    ..   .     .      .  . : ;':::.
                     /     :go. :       . :    \ : ;'.::.
                   |     ' .o8)     .  :|    : ,'. .
                  /     :   ~:'  . '   :/  . :/. .
                 /       ,  '          |   : /. .
                /       ,              |   ./.
                L._    .       ,' .:.  /  ,'.
               /-.     :.--._,-'~~~~~~| ,'|:
              ,--.    /   .:/         |/::| `.
              |-.    /   .;'      .-__)::/    \
 ...._____...-|-.  ,'  .;'      .' '.'|;'      |
   ~--..._____\-_-'  .:'      .'   /  '
    ___....--~~   _.-' `.___.'   ./
      ~~------+~~_. .    ~~    .,'
                  ~:_.' . . ._:'
                     ~~-+-+~~




                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
SQL Syntax          |/\    | \_/-'\ \
                    A |   /  ||   /_/
                      |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__



                   _    _
                  / \__/ \_____
4.1 lexical      /  /  \  \    `\
    structure    )  \''/  (     |\
                 `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'

tokens

SELECT * FROM MY_TABLE;

each are tokens
the whole thing is a command


comments  are  done with

 -- comment




      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   in SQL, sometimes the tokens matter
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~


                          ___.---.___
                        .'  (     )  '.
4.1.1. Identifiers      )   /)' '(    )
 and Key Words          ',_( ';-;'\_,'
                              |-|
                              (")

key words
ex
    SELECT, UPDATE, INSERT,DROP

identifiers MY_CUSTOM_TABLE,YOUR_CUSTOM_VIEW




     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   in SQL, dont use $ signs
       /_/   _  /\
       |/ |\ || |
         ~ ~  ~



for identides, they should not be longer than  NAMEDATALEN-1 bytes which is 64
to change this
 NAMEDATALEN constant in src/include/pg_config_manual.h.


IMPT!!!!
 Key words and unquoted identifiers are case insensitive

UPDATE MY_TABLE SET A = 5;
    can equivalently be written as:
uPDaTE my_TabLE SeT a = 5;
    A convention often used is to write key words in upper case and names in lower case, e.g.:
UPDATE my_table SET a = 5;


Delimited idenitifers, words in quotes

UPDATE "my_table" SET "a" = 5;
"UPDATE" would be a identifier then


write "data" as
U&"d\0061t\+000061"

write "slon" as
U&"\0441\043B\043E\043D"



                          ___.---.___
                        .'  (     )  '.
4.1.2. Constants        )   /)' '(    )
                        ',_( ';-;'\_,'
                              |-|
                              (")


String Constants


in SQL, arbitrary sequence of characters bounded by single quotes ('),


SELECT 'foo'      ===
'bar';                          SELECT 'foobar';

lots of more escape stuff



Bit String Constants
exx

B'1001'
only 0 and 1 allowed within quoutes


Numeric Constants

all are taken

1. digits
2. digits.[digits][e[+-]digits]
3. [digits].digits[e[+-]digits]
4. digitse[+-]digits


ex
42
3.5
4.
.001
5e2
1.925e-3


ints are first int (32 bit) bigint (64 bit) then numeric
floating point are always considered numeric

u can force a numeric value to be treated as a type

REAL '1.23' -- string style



4.1.2.7. Constants of Other Types

you can make your own type

type 'string'
'string'::type
CAST ( 'string' AS type )


                          ___.---.___
                        .'  (     )  '.
4.1.3. Operators        )   /)' '(    )
                        ',_( ';-;'\_,'
                              |-|
                              (")

can only get NAMEDATALEN-1 (63 by default) chars


+ - * / < > = ~ ! @ # % ^ & | ` ?



     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    -- and /* cannot appear in an operator name
       /_/   _  /\  multi-char operator cannot end in   + or - unless it has ~ ! @ # % ^ & | ` ?
       |/ |\ || |
         ~ ~  ~




                          ___.---.___
                        .'  (     )  '.
4.1.4. Special          )   /)' '(    )
    Characters           ',_( ';-;'\_,'
                              |-|
                              (")

A dollar sign ($) followed by digits is used to represent a positional parameter in the body of a function
definition or a prepared statement. In other contexts the dollar sign can be part of an identifier or a
dollar-quoted string constant.

() used to group expressions and enforce order

[] used to select from an array see section 8.15

, to seperate elements of a list

; it terminates a SQL command

:selects slices from arrays, also might be used to prefix var names

* a select all feature

. used as decimal  and seperate schema.table.column



                          ___.---.___
                        .'  (     )  '.
4.1.5.  Comments        )   /)' '(    )
                        ',_( ';-;'\_,'
                              |-|
                              (")


single line
--
mult line

/* multiline comment
 * with nesting: /* nested block comment */
 */



                          ___.---.___
                        .'  (     )  '.
4.1.6.   Operator       )   /)' '(    )
         Precedence      ',_( ';-;'\_,'
                              |-|
                              (")

location: mydb/ operator_precedence
this is a very important table


CREATE TABLE operator_precedence (
 Operator_Element       varchar(100),
 Associativity          varchar(100),
 Description            varchar(100)

);


COPY operator_precedence FROM '/home/uoul/My_Computer/Database_Folder/PostgreSQL/CSV/op.txt' WITH (FORMAT csv);

for problems like this
SELECT 5 ! - 6;
SELECT 5 ! (- 6);
SELECT (5 !) - 6;

postgres 9.5 and before used slighty







                 / \__/ \_____
4.2. Value      /  /  \  \    `\
    Expressions )  \''/  (     |\
                 `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'


known as scalar expressions

• A constant or literal value
• A column reference
• A positional parameter reference, in the body of a function definition or prepared statement
• A subscripted expression
• A field selection expression
• An operator invocation
• A function call
• An aggregate expression
• A window function call
• A type cast
• A collation expression
• A scalar subquery
• An array constructor
• A row constructor
• Another value expression in parentheses (used to group subexpressions and override precedence)


                          ___.---.___
                        .'  (     )  '.
4.2.1.   Column         )   /)' '(    )
         Reference      ',_( ';-;'\_,'
                              |-|
                              (")



      _    _
     /=\""/=\
    (=(0_0 |=)__             a colunm can be referenced in the form
     \_\ _/_/   )           correlation.columnname
       /_/   _  /\           use like this
      |/ |\ || |            select accounts.name from accounts;
         ~ ~  ~


                          ___.---.___
                        .'  (     )  '.
4.2.2.   Positional     )   /)' '(    )
         Parameters      ',_( ';-;'\_,'
                              |-|
                              (")

it looks like this
$number
like js parameters passed to a function



CREATE FUNCTION dept(text) RETURNS dept
 AS $$ SELECT * FROM dept WHERE name = $1 $$
 LANGUAGE SQL;


                          ___.---.___
                        .'  (     )  '.
4.2.3.   Subscripts     )   /)' '(    )
                        ',_( ';-;'\_,'
                              |-|
                              (")

when dealing with arrays

expression[subscript]
expression[lower_subscript:upper_subscript]



                          ___.---.___
                        .'  (     )  '.
4.2.4.    Field         )   /)' '(    )
          Selection     ',_( ';-;'\_,'
                              |-|
                              (")


if you get a row back you can use
expression.fieldname to get a parameter in the row


to access

mytable.mycolumn
$1.somecolumn
(rowfunction(a,b)).col3

(compositecol).somefield
(mytable.compositecol).somefield



                          ___.---.___
                        .'  (     )  '.
4.2.5.    Operator      )   /)' '(    )
          Invocations    ',_( ';-;'\_,'
                              |-|
                              (")

three ways

expression operator expression (binary infix operator)
operator expression (unary prefix operator)
expression operator (unary postfix operator)


                          ___.---.___
                        .'  (     )  '.
4.2.6.     Function     )   /)' '(    )
          Calls         ',_( ';-;'\_,'
                              |-|
                              (")


to make a function call

function_name ([expression [, expression ... ]] )

CREATE FUNCTION dept(text) RETURNS accounts
 AS $$
    SELECT * FROM accounts WHERE name = $1
    $$
 LANGUAGE SQL;
SELECT dept('Bob')

$1 represents the parameter text


                          ___.---.___
                        .'  (     )  '.
4.2.7.    Aggregate     )   /)' '(    )
          Expressions   ',_( ';-;'\_,'
                              |-|
                              (")


SELECT array_agg(name ORDER BY balance DESC) FROM accounts;

when using order by it must go after all the aggregate argumennts

SELECT string_agg(name, ',' ORDER BY balance) FROM accounts;

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   array_agg takes everything in a column and puts it into an array
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   string_agg takes everything in a column and puts it into an string seperated by the 2nd column
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   The ability to specify both DISTINCT and ORDER BY in an aggregate function is a
       /_/   _  /\  PostgreSQL extension
      |/ |\ || |
         ~ ~  ~


4.2.8. Window Function Calls


                          ___.---.___
                        .'  (     )  '.
4.2.8. Window           )   /)' '(    )
  Function Calls        ',_( ';-;'\_,'
                              |-|
                              (")

PARTITION BY only returns expressions, not output names

i dont understand I have not seen a window function in practice


                          ___.---.___
                        .'  (     )  '.
4.2.9. Type Casts       )   /)' '(    )
                        ',_( ';-;'\_,'
                              |-|
                              (")


just be careful but there are tools to help you from making mistakes
it not showing you how to use them


                          ___.---.___
                        .'  (     )  '.
4.2.10. Collition       )   /)' '(    )
        Expressions     ',_( ';-;'\_,'
                              |-|
                              (")

Collation - writing of information to a standard order

db :roomate_misteps

SELECT date, media_link, incident_part FROM mailperson  ORDER BY media_link COLLATE "7";
idk man




                          ___.---.___
                        .'  (     )  '.
4.2.11. Scalar          )   /)' '(    )
Subqueries              ',_( ';-;'\_,'
                              |-|
                              (")


For example, the following finds the largest city population in each state:

SELECT name, (SELECT max(pop) FROM cities WHERE cities.state =
 states.name)
 FROM states;


 this query would help me find the max times from each row in mailperson off equal dates but for the rows that have more then one media link, we have to choose a time then link it back into that empty row in the table a complex query I have no idea of doing

SELECT  distinct date , (SELECT max(times) FROM mailperson )FROM mailperson a INNER JOIN "73743e9466173e49ae700962e461054cb99e52e0d2bbc828" b ON(true);



      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    scalar is like one distict result out of a query
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~



                          ___.---.___
                        .'  (     )  '.
4.2.12. Array           )   /)' '(    )
Constructors            ',_( ';-;'\_,'
                              |-|
                              (")

what it is
SELECT ARRAY[1,2,3+4];


to type cast an array
SELECT ARRAY[1,2,22.7]::integer[];


a multidimensional array

SELECT ARRAY[[1,2],[3,4]];
SELECT ARRAY[[1,2],[3,4],5];
SELECT ARRAY[[1,2],[3,4],[7.2,2]];

the problem with the second is that this is typescript like reponse where it expected to be array[][2]
they also cant take strings

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     in postgreSQL arrays look like  this {}
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

can construct an array from a subquery

db: roomate_misteps
SELECT ARRAY((SELECT max(times) FROM mailperson ));



      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     for this to work it must return a single column
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~


4.2.13. Row Constructors

                          ___.---.___
                        .'  (     )  '.
4.2.13. Row             )   /)' '(    )
Constructors            ',_( ';-;'\_,'
                              |-|
                              (")

db: roomate_misteps
to make a random row not part of a table

SELECT ROW(1,2.5,'this is a test');


to get rows and concatenate a value to each in memory
SELECT ROW(mailperson.*, 42) FROM mailperson;
SELECT ROW(mailperson.date, 42) FROM mailperson;



db mydb
CREATE TABLE mytable(f1 int, f2 float, f3 text);
CREATE FUNCTION getf1(mytable) RETURNS int AS 'SELECT $1.f1' LANGUAGE
 SQL;

CREATE TYPE myrowtype AS (f1 int, f2 text, f3 numeric);

CREATE FUNCTION getf1(myrowtype) RETURNS int AS 'SELECT $1.f1'
 LANGUAGE SQL;

-- fot tables we dont need to cast
SELECT getf1(ROW(1,2.5,'this is a test'));

-- if you had two or more different tagbles using the same function name you must use these below:
SELECT getf1(ROW(1,2.5,'this is a test')::mytable);


SELECT getf1(CAST(ROW(11,'this is a test',2.5) AS myrowtype));

SELECT ROW(1,2.5,'this is a test') = ROW(1, 3, 'not the same')


     _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )       if you get f its false if you get t its true, in postgreSQL only 1 = for comaprsion
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~


4.2.14. Expression Evaluation Rules


                          ___.---.___
                        .'  (     )  '.
4.2.14. Expression      )   /)' '(    )
Evaluation Rules         ',_( ';-;'\_,'
                              |-|
                              (")

sometimes your subexpressions dont evaluate at all

in postgrest it wont event get to somefunc()

SELECT true OR somefunc();




      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    DONT use functions that have side effects as part of complex expressions
       /_/   _  /\   especially with where and having. boolean expression will do nasty things
      |/ |\ || |
         ~ ~  ~

to deal with this use the CASE keyword a construct but use when necessary

SELECT ... WHERE CASE WHEN x > 0 THEN y/x > 1.5 ELSE false END;

this will fail because the query is in the planning stage so dont use immutable expressions (1/0) there


SELECT CASE WHEN x > 0 THEN x ELSE 1/0 END FROM tab;


also will fail with aggregates

SELECT CASE WHEN min(employees) > 0
 THEN avg(expenses / employees)
 END
 FROM departments;

because aggregates compute first so the min and avg run befor the THEN  can do its job



      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    use IF-THEN-ELSE  over CASE
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~



               _    _
              / \__/ \_____
4.3          /  /  \  \    `\
Calling      )  \''/  (     |\
Function     `\__)/__/'_\  / `
                //_|_|~|_|_|
                ^""'"' ""'"'

positinoal notation
named      notation useful for many arguments
mixed      notattion

sample

CREATE FUNCTION concat_lower_or_upper(a text, b text, uppercase
 boolean DEFAULT false)
RETURNS text
AS
$$
 SELECT CASE
 WHEN $3 THEN UPPER($1 || ' ' || $2)
 ELSE LOWER($1 || ' ' || $2)
 END;
$$
LANGUAGE SQL IMMUTABLE STRICT;


concat_lower_or_upper
two must params,
    a&b
optional
    uppercase its default is false


                             ___.---.___
                           .'  (     )  '.
4.3.1. Using Positional    )   /)' '(    )
Notation                   ',_( ';-;'\_,'
                                 |-|
                                 (")


this is positional
SELECT concat_lower_or_upper('Hello', 'World', true);

left to right
with defaults right to left so this


CREATE FUNCTION cU(a text DEFAULT 'yamcha', b text, uppercase
 boolean DEFAULT false)

does not work


                             ___.---.___
                           .'  (     )  '.
4.3.2. Using Named         )   /)' '(    )
Notation                   ',_( ';-;'\_,'
                                 |-|
                                 (")


there are more like function calls
done in any order
SELECT concat_lower_or_upper(b => 'World',a => 'Hello');




      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )       use := for backwards compatablility
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~




                             ___.---.___
                           .'  (     )  '.
4.3.3. Using Mixed         )   /)' '(    )
Notation                   ',_( ';-;'\_,'
                                 |-|
                                 (")


also more fucntion calls
SELECT concat_lower_or_upper('Hello', 'World', uppercase => true);



                   _    _
                  / \__/ \_____
 pg 1555         /  /  \  \    `\
 pdf pg 1594     )  \''/  (     |\
Copy             `\__)/__/'_\  / `
                    //_|_|~|_|_|
                    ^""'"' ""'"'

incomplete for more return here


COPY table_name [ ( column_name [, ...] ) ]
 FROM { 'filename' | PROGRAM 'command' | STDIN }
 [ [ WITH ] ( option [, ...] ) ]

COPY { table_name [ ( column_name [, ...] ) ] | ( query ) }
 TO { 'filename' | PROGRAM 'command' | STDOUT }
 [ [ WITH ] ( option [, ...] ) ]

where option can be one of:
 FORMAT format_name
 OIDS [ boolean ]
 FREEZE [ boolean ]
 DELIMITER 'delimiter_character'
 NULL 'null_string'
 HEADER [ boolean ]
 QUOTE 'quote_character'
 ESCAPE 'escape_character'
 FORCE_QUOTE { ( column_name [, ...] ) | * }
 FORCE_NOT_NULL ( column_name [, ...] )
 FORCE_NULL ( column_name [, ...] )
 ENCODING 'encoding_name'


can also copy from select



COPY accounts TO '/home/uoul/My_Computer/Database_Folder/PostgreSQL/homefile_name.csv' DELIMITER ',' CSV HEADER

when program is specified there is software the postgresql user must have permission to use
when STDIN or STDOUT is specified there is a socket

query
    A SELECT, VALUES, INSERT, UPDATE or DELETE
    E command whose results are to be copied.

For INSERT, UPDATE and DELETE queries a RETURNING clause must be provided, and the target
relation must not have a conditional rule, nor an ALSO rule, nor an INSTEAD rule that expands to
multiple statements.


FORMAT  select data format,
default:text
        binary
        csv


DELIMITER
    specifies how the indexes are seperated
    tab for  text format a comma for csv
    1 byte char is allowed not allowed for binary

NULL
    Specifies the string that represents a null value. The default is \N (backslash-N) in text format, and
    an unquoted empty string in CSV format.


HEADER
    on output  inputs column names, on input first line is ignored consided to be column names



On Success
    COPY count - number of rows copied

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- use  COPY (SELECT* FROM viewname) TO  when dealing with views
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- COPY (SELECT * FROM table) TO when you have child tables
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- only db superusers and those with  pg_read_server_files,
       /_/   _  /\    pg_write_server_files, or pg_execute_server_program
      |/ |\ || |
         ~ ~  ~

      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- use absolute file paths
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- COPY on error stops at first operation in a copy from this is a memory leak
       /_/   _  /\   -- use VACUUM to recover wasted space
      |/ |\ || |
         ~ ~  ~

     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )     -- FORCE_NULL and FORCE_NOT_NULL can be used simultaneously on the same column. This results in
       /_/   _  /\   -- converting quoted null strings to null values and unquoted null strings to empty strings.
      |/ |\ || |
         ~ ~  ~



                             ___.---.___
                           .'  (     )  '.
      File Formats         )   /)' '(    )
                            ',_( ';-;'\_,'
                                 |-|
                                 (")


    Text format

copy from raises an error is there are more or less columns than

end of data is by a [\.] only used  in pre-3.0 applications

need an extra slash to deal with these

\b          Backspace (ASCII 8)
\f          Form feed (ASCII 12)
\n          Newline (ASCII 10)
\r          Carriage return (ASCII 13)
\t          Tab (ASCII 9)
\v          Vertical tab (ASCII 11)
\digits     Backslash followed by one to three octal digits specifies the character with that numeric code
\xdigits    Backslash x followed by one or two hex digit specifies the character with that numeric code

dont add too many \

copy from will complain if the line ending are not all alike


    CSV format

can use FORCE_QUOTE to force quotes for non-null values

The CSV format has no standard way to distinguish a NULL value from an empty string. PostgreSQL's
COPY handles this by quoting.


just remember to properly format your files


    Binary Format

its faster, but more difficult to use it rejects data types



                             ___.---.___
                           .'  (     )  '.
      File Header          )   /)' '(    )
                            ',_( ';-;'\_,'
                                 |-|
                                 (")


15 bytes of fixed fields, followed by a variable-length header extension area

Signature

    11-byte sequence PGCOPY\n\377\r\n\0  note that the zero byte is a required part of the signature.

    32-bit integer bit mask to denote important aspects of the file format.
    Bit 16
    if 1, OIDs are included in the data; if 0, not

Header extension area length
    
    32-bit integer, length in bytes of remainder of header, not including self. reader should skip unfamiliar header extensions

    for future use



                             ___.---.___
                           .'  (     )  '.
      Tuples               )   /)' '(    )
                            ',_( ';-;'\_,'
                                 |-|
                                 (")

Each tuple begins with a 16-bit integer count of the number of fields in the tuple.


                             ___.---.___
                           .'  (     )  '.
      File                 )   /)' '(    )
    Trailer                ',_( ';-;'\_,'
                                 |-|
                                 (")

The file trailer consists of a 16-bit integer word containing -1.
A reader should report an error if a field-count word is neither -1 nor the expected number of columns.


                             ___.---.___
                           .'  (     )  '.
      Examples             )   /)' '(    )
                           ',_( ';-;'\_,'
                                 |-|
                                 (")


split a table by '|' and send to a client

COPY country TO STDOUT (DELIMITER '|');

To copy data from a file into the country table:

COPY country FROM '/usr1/proj/bray/sql/country_data';


To copy into a compressed file, you can pipe the output through an external compression program:

COPY country TO PROGRAM 'gzip > /usr1/proj/bray/sql/country_data.gz';


Here is a sample of data suitable for copying into a table from STDIN:
AF  AFGHANISTAN
AL  ALBANIA
DZ  ALGERIA
ZM  ZAMBIA
ZW  ZIMBABWE
Note that the white space on each line is actually a tab character.
The following is the same data, output in binary format. The data is



                             ___.---.___
                           .'  (     )  '.
      Compatibility        )   /)' '(    )
                           ',_( ';-;'\_,'
                                 |-|
                                 (")


no copy in SQL,

other ways of using copy

backwatds compatible

before 9.0

COPY table_name [ ( column_name [, ...] ) ]
 FROM { 'filename' | STDIN }
 [ [ WITH ]
 [ BINARY ]
 [ OIDS ]
 [ DELIMITER [ AS ] 'delimiter' ]
 [ NULL [ AS ] 'null string' ]
 [ CSV [ HEADER ]
 [ QUOTE [ AS ] 'quote' ]
 [ ESCAPE [ AS ] 'escape' ]
 [ FORCE NOT NULL column_name [, ...] ] ] ]

COPY { table_name [ ( column_name [, ...] ) ] | ( query ) }
 TO { 'filename' | STDOUT }
 [ [ WITH ]
 [ BINARY ]
 [ OIDS ]
 [ DELIMITER [ AS ] 'delimiter' ]
 [ NULL [ AS ] 'null string' ]
 [ CSV [ HEADER ]
 [ QUOTE [ AS ] 'quote' ]
 [ ESCAPE [ AS ] 'escape' ]
 [ FORCE QUOTE { column_name [, ...] | * } ] ] ]


before 7.3

COPY [ BINARY ] table_name [ WITH OIDS ]
 FROM { 'filename' | STDIN }
 [ [USING] DELIMITERS 'delimiter' ]
 [ WITH NULL AS 'null string' ]
COPY [ BINARY ] table_name [ WITH OIDS ]
 TO { 'filename' | STDOUT }
 [ [USING] DELIMITERS 'delimiter' ]
 [ WITH NULL AS 'null string' ]



                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
18  Server          |/\    | \_/-'\ \
    Setup  and      A |   /  ||   /_/
    Operation         |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__


                      _    _
                     / \__/ \_____
18.1 The postgres   /  /  \  \    `\
SQL user account    )  \''/  (     |\
                    `\__)/__/'_\  / `
                       //_|_|~|_|_|
                       ^""'"' ""'"'
            
the user account must only handle the database use something other than postgres when your more familiar


                      _    _
                     / \__/ \_____
18.2 Creating       /  /  \  \    `\
Database Cluster    )  \''/  (     |\
                    `\__)/__/'_\  / `
                       //_|_|~|_|_|
                       ^""'"' ""'"'

basically where the postgres in its fullness is set up
/usr/local/pgsql/data or /var/lib/pgsql/data is where your data goes
template1 helps make other databases dont use it
postgres is used by many 3rd party apps

to initalize a database cluster

initdb -D /usr/local/pgsql/data


do this while logged into the postgres user acct


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   As an alternative to the -D option, you can set the environment variable PGDATA.
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

postgres need access to the parent directory of the data directory
it refueses to run if it sees an existing installation

use C or POSIX locales


                                   ___.---.___
                                 .'  (     )  '.
 Use of Secondary File Systems   )   /)' '(    )
                                  ',_( ';-;'\_,'
                                       |-|
                                       (")

 Best practice is to create a directory within the mount-point directory
that is owned by the PostgreSQL user, and then create the data directory within that
this avoids permission problems


                                   ___.---.___
                                 .'  (     )  '.
Use of Network File Systems      )   /)' '(    )
                                  ',_( ';-;'\_,'
                                       |-|
                                       (")


mount the NFS file system synchronously (without caching)
Storage Area Networks (SAN) typically use communication protocols other than NFS
read their documentation


                          _    _
                         / \__/ \_____
18.3  Starting          /  /  \  \    `\
the Database Server     )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

to start it the postgres program must know where the data is

postgres -D /usr/local/pgsql/data >logfile 2>&1 &

place the stdout and stderr somewhere impt


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )  without -D it would look at PGDATA env variable
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~
    

Autostart scripts are operating-system-specific. There are a few distributed with PostgreSQL in the contrib/start-scripts
directory

PID is stored in the file postmaster.pid used to prevent process from running in the same dir and shutting ddown the daemon



                                   ___.---.___
                                 .'  (     )  '.
18.3.1 Server Start-up Failures  )   /)' '(    )
                                  ',_( ';-;'\_,'
                                       |-|
                                       (")


FATAL: could not create shared memory segment: Invalid argument
DETAIL: Failed system call was shmget(key=5440001, size=4011376640,
 03600)

means the kernel has less space for shared bufffers, multiple daemons
are asking for to much or doesnt even support the feature
start the daemon with a smaller number,


FATAL: could not create semaphores: No space left on device
DETAIL: Failed system call was semget(5440126, 17, 03600).

means you have to reconfigure the kernel to allow for more max connections



                                          ___.---.___
                                        .'  (     )  '.
18.3.2. Client Connection Problems      )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")



psql: could not connect to server: Connection refused

configure the server to allow TCP/IP



psql: could not connect to server: No such file or directory

are you in the right place


Connection timed out
no internet connection




                          _    _
                         / \__/ \_____
18.4. Managing Kernel   /  /  \  \    `\
 Resources              )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

when you have several postgresDB it can use up too much kernel



                                          ___.---.___
                                        .'  (     )  '.
18.4.1. Shared Memory and Semaphores    )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")


postgreSQL needs the OS to provide IPC (inter process communication) features
if its not there you get a 'illegal system call' on server start

on server start
gets little System V shared memory
gets a good amnt of POSIX(nmap) shared memory


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )    before PostgreSQL 9.3, only System V shared memory was used
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~


check out the table for some comon kernel parameters you might have to change


 Lowering the number of allowed connections
is a temporary workaround for failures, which are usually confusingly worded

“No space left on device”


      _    _
     /=\""/=\
    (=(0_0 |=)__
     \_\ _/_/   )   a page is usually 4096 bytes use getconf PAGE_SIZE to verify
       /_/   _  /\
      |/ |\ || |
         ~ ~  ~

to allow 16gb

16 GB:
$ sysctl -w kernel.shmmax=17179869184
$ sysctl -w kernel.shmall=4194304

use /etc/sysctl.conf to save changes



                                          ___.---.___
                                        .'  (     )  '.
18.4.2. systemd RemoveIPC               )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")


LOG: semctl(1234567890, 0, IPC_RMID, ...) failed: Invalid argument


when installing from source postgres might not be a system user
so when they log out they lose their shared memory


a system user is determiend by
SYS_UID_MAX setting in /etc/login.defs

if done wrong

in /etc/systemd/logind.conf or another conf file


RemoveIPC=no


                                          ___.---.___
                                        .'  (     )  '.
18.4.3. Resource Limits                 )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")


on linux

file max:x /proc/sys/fs/file-max

resource /usr/src/linux/Documentation/proc.txt

set
PostgreSQL's max_files_per_process
configuration parameter to limit the consumption of open files.


                                          ___.---.___
                                        .'  (     )  '.
18.4.4. Linux Memory Overcommit         )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")

in Linux 2.4 and later  default virtual memory behavior
is not the best because if postgres asks for too much
the kernel will terminate the master process

OOM(out of memory) killer only used when swap space is exhausted



if postgres is doing this lower

shared_buffers
work_mem
max_connections
and use external connection pooling software



to make it harder for the OOM killer to come out

sysctl -w vm.overcommit_memory
and look  https://www.kernel.org/doc/Documentation/vm/overcommit-accounting

to make the OOM kill someone else as root
 

export PG_OOM_ADJUST_FILE=/proc/self/oom_score_adj
export PG_OOM_ADJUST_VALUE=0

postmaster startup script

	add:[file]
	---------------------------------------------
	---------------------------------------------

	-->

	---------------------------------------------
    [anadir] echo -1000 > /proc/self/oom_score_adj
	---------------------------------------------
on older kernels use /proc/self/oom_adj and echo -17


                                          ___.---.___
                                        .'  (     )  '.
18.4.5. Linux Huge Pages                )   /)' '(    )
                                        ',_( ';-;'\_,'
                                              |-|
                                              (")

helps reduce overhead
it will fail to start if not enough are availble
resource https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt.



                          _    _
                         / \__/ \_____
18.5. Shutting          /  /  \  \    `\
 Down the Server        )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

SIGTERM
    daemon rejecs new connections and shut down when connections terminate,
    in recovery mode after after regular sessions are termination it will stop streaming and recovery

SIGINT
    stops new connections sends SIGTERM to existing process and backup is useless

SIGQUIT
    sends SIGQUIT to all child process in 5 seconds sends a SIGKILL, the master process closes
    on startup this is database recovery, only in extreme situations

do not use SIGKILL or you will have to manually release the IPC and kill all subprocesses



                          _    _
                         / \__/ \_____
18.5.  Upgrading        /  /  \  \    `\
 a PostgreSQL Cluster   )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'


releases

after 10
10.1
10 is major 1 is minor
before 10
9.5.3
9.5 major 3 minor


to upgrade between minor release simply replace the executables while the server is down

major relases
internal data storage format changes, you must dump and reload the database
but there is software to help, also client become incompatible


makes it better for admin to control the daemon
improves on the SQL
Library API like libpq only addes new features
System Catalogs only affect db management tools
change low level C deep in the server



                              ___.---.___
                            .'  (     )  '.
18.6.1. Upgrading Data      )   /)' '(    )
via pg_dumpall              ',_( ';-;'\_,'
                                  |-|
                                  (-)

its a logical backup tool
can use this to backup you work
use this tool from postgres 11.3
us the pg_dump and pg_dumpall for newer versions of pgsql

enviornment

installation :   /usr/local/pgsql
data dir     :   /usr/local/pgsql/data


edit
/usr/local/pgsql/data/pg_hba.conf
to make sure no one has access, or the updated stuff wont be included


1. backup server
pg_dumpall > yourPostgresDB

2.shut down old server
pg_ctl stop

3.rename the old installation directory
mv /usr/local/pgsql /usr/local/pgsql.old

4. install the new postgreSQL according to 16.4

5.create a new database cluster if needed
/usr/local/pgsql/bin/initdb -D /usr/local/pgsql/data or that PGDATA env variable
so you dont need the -D [file]

6. Restore your previous pg_hba.conf and any postgresql.conf modifications.

7. start new database
/usr/local/pgsql/bin/postgres -D /usr/local/pgsql/data

8. restore your database
/usr/local/pgsql/bin/psql -d postgres -f outputfile


                              ___.---.___
                            .'  (     )  '.
18.6.2. Upgrading Data      )   /)' '(    )
via pg_upgrade              ',_( ';-;'\_,'
                                  |-|
                                  (-)

refer to pg_upgrade documentation


                              ___.---.___
                            .'  (     )  '.
18.6.3. Upgrading Data      )   /)' '(    )
via Replication              ',_( ';-;'\_,'
                                  |-|
                                  (-)

it uses logical replication, read here for more info




                          _    _
                         / \__/ \_____
18.7. Preventing        /  /  \  \    `\
 Server Spoofing        )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

read more

if the server is down some can come in and run their own server,
which can read client passwords but PGDATA is secure of directory permissions
a client cannot identify a bad server unless it configured for this

for local connections clients can use require peer for the server user to send their name

to prevent TCP spoofing use SSL certificates and have the clients check em



                          _    _
                         / \__/ \_____
18.8. Encryption        /  /  \  \    `\
 Options                )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'


Password Encryption
    stored as a hash, use SCRAM because the password is always encrypted before it gets to the server

Encryption For Specific Columns
     use pgcrypto module, is it decrpyted on the server and sent to the client, however because the decrypted data and key on the server for a brief time someone can get their hands on them

Data Partition Encryption
    linux got this feature, the stealer needs to mount the drive and have the key to access the encrpyted data

Encrypting Data Across A Network
    SSL always does this read here for permissions and config

SSL Host Authentication
    this is when both the client and server send certificates

Client-Side Encryption
    if you dont trust the database server encrypt it on the client, i think this is the best method


                          _    _
                         / \__/ \_____
18.9. Secure            /  /  \  \    `\
  TCP/IP                )    \''/  (    |\
Connections with SSL    `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'






                              ___.---.___
                            .'  (     )  '.
18.9.1. Basic Setup         )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

with SSL support  start the server
 postgresql.conf

i have it enabled on mine
i also got the cert key and the pem key

					add:[file]
					---------------------------------------------
                    ssl
					---------------------------------------------

					-->

					---------------------------------------------
					---------------------------------------------

on unix
chmod 0600 server.key
or own by root and
chmod 0640 server.key

if data directory allows group access certificate files may be needed to be loaded outside the dir

if private key is passphase protected, server will need it and cant change SSL config without a server restart

The first certificate in server.crt must be the server's certificate because it must match the server's
private key. The certificates of “intermediate” certificate authorities can also be appended to the file.



                              ___.---.___
                            .'  (     )  '.
18.9.2. OpenSSL             )   /)' '(    )
Configuration                ',_( ';-;'\_,'
                                  |-|
                                  (-)

this what postgres uses
 openssl version -d


                              ___.---.___
                            .'  (     )  '.
18.9.3. Using               )   /)' '(    )
Client Certificates         ',_( ';-;'\_,'
                                  |-|
                                  (-)


refer here



                              ___.---.___
                            .'  (     )  '.
18.9.4                      )   /)' '(    )
4. SSL Server File Usage    ',_( ';-;'\_,'
                                  |-|
                                  (-)

if there is an error  in those files the server will refuse to start or the old configuration will be used


                              ___.---.___
                            .'  (     )  '.
18.9.5                      )   /)' '(    )
 Creating Certificates      ',_( ';-;'\_,'
                                  |-|
                                  (-)

read for more ingo

replace domain with yr server name

openssl req -new -x509 -days 365 -nodes -text -out server.crt \
 -keyout server.key -subj "/CN=dbhost.yourdomain.com"
chmod og-rwx server.key

use a certificate signed by a CA in production



To create a server certificate whose identity can be validated by clients, first create a certificate signing
request (CSR) and a public/private key file:

openssl req -new -nodes -text -out root.csr \
 -keyout root.key -subj "/CN=root.yourdomain.com"
chmod og-rwx root.key


openssl x509 -req -in root.csr -text -days 3650 \
 -extfile /etc/ssl/openssl.cnf -extensions v3_ca \
 -signkey root.key -out root.crt


openssl req -new -nodes -text -out server.csr \
 -keyout server.key -subj "/CN=dbhost.yourdomain.com"
chmod og-rwx server.key

openssl x509 -req -in server.csr -text -days 365 \
 -CA root.crt -CAkey root.key -CAcreateserial \
 -out server.crt



                          _    _
                         / \__/ \_____
 18.10. Secure          /  /  \  \    `\
 TCP/IP Connections     )  \''/  (     |\
with SSH tunnels        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

so you set up ssh port mapping then have your client reach that endpoint port to get to the database
read here for more




                                                     _    _
                                                    / \__/ \_____
18.11. Registering Event Log on Windows            /  /  \  \    `\
 Log on Windows                                    )  \''/  (     |\
                                                   `\__)/__/'_\  / `
                                                      //_|_|~|_|_|
                                                      ^""'"' ""'"'

                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
19. Server          |/\    | \_/-'\ \
Configuration       A |   /  ||   /_/
                       |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__


usually most can be done thru
the postgresql.conf file or on the server command line.

or at server start
                          _    _
                         / \__/ \_____
 19.1. Setting          /  /  \  \    `\
 Parameters             )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'



                              ___.---.___
                            .'  (     )  '.
19.1.1. Parameter           )   /)' '(    )
Names and Values             ',_( ';-;'\_,'
                                  |-|
                                  (-)

refer here for rules so when you see system config you know what to do


                              ___.---.___
                            .'  (     )  '.
19.1.2. Parameter           )   /)' '(    )
Interaction via the        ',_( ';-;'\_,'
   Configuration File             |-|
                                  (-)

the easiest way to set system parameters

 postgresql.conf



the configuration file is reread with a
pg_ctl reload
or with SQL pg_reload_conf().


NEVER touch postgresql.auto.conf()

use The system view pg_file_settings
if sighup did not have desired effects


                              ___.---.___
                            .'  (     )  '.
19.1.3. Parameter           )   /)' '(    )
Interaction via the        ',_( ';-;'\_,'
  SQL                             |-|
                                  (-)

You can use ALTER DATABASE, ALTER SYSTEM and ALTER ROLE

for session only commands
to see a value
SHOW or  current_setting(setting_name text).

to change a value
SET or  set_config(setting_name, new_value, is_local)


you also have pg_settings in the postgres database as a table
use the SET keyword in place of UPDATE here
SET configuration_parameter TO DEFAULT;



                              ___.---.___
                            .'  (     )  '.
19.1.4. Parameter           )   /)' '(    )
Interaction via the        ',_( ';-;'\_,'
  shell                           |-|
                                  (-)

to pass params at server startup from shell
postgres -c log_connections=yes -c log_destination='syslog'


using libpq terminal client
env PGOPTIONS="-c geqo=off -c statement_timeout=5min" psql





                              ___.---.___
                            .'  (     )  '.
19.1.5. Managing           )   /)' '(    )
Configuration File         ',_( ';-;'\_,'
  contents                        |-|
                                  (-)


the postgresql.conf file can be split, and this is done with these include directives( remember your C days this is nothing more than a node.js import). use absolute paths

include 'filename'

use this if you dont know if the file exists

include_if_exists


also to include directories, from what i understand it looks for .conf and avoids . (hidden files)
include_dir 'directory'


in practice

ex

include 'shared.conf'
include 'memory.conf'
include 'server.conf' # server specs


include_dir 'conf.d'
# then in conf.d
00shared.conf
01memory.conf
02server.conf

this establishes naming convention
also making naming more descriptive



                          _    _
                         / \__/ \_____
19.2. File Locations    /  /  \  \    `\
                        )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'



                              ___.---.___
                            .'  (     )  '.
19.2.1. Managing           )   /)' '(    )
Configuration File         ',_( ';-;'\_,'
  contents                        |-|
                                  (-)


read more on how to use

data_directory (string)
only at server start


config_file (string)               name:postgresql.conf
only set on postgres command line


hba_file (string)                  name:pg_hba.conf
host based authentication file
only set at server start


ident_file (string)                name:pg_ident.conf
 user name mapping
only at server start



external_pid_file (string)
additon PID file for use by server admin programs
only at server start



                          _    _
                         / \__/ \_____
19.3.  Connections      /  /  \  \    `\
     and Authentication )  \''/  (     |\
                        `\__)/__/'_\  / `
                           //_|_|~|_|_|
                           ^""'"' ""'"'

so for each psql function, its the same as the index in column name in the pg_settings in the postgres database


                              ___.---.___
                            .'  (     )  '.
19.3.1. Connection          )   /)' '(    )
 Settings                   ',_( ';-;'\_,'
                                  |-|
                                  (-)



listen_addresses(string)

chooses what IP address to listen to

('*') - all IP intefaces
(0.0.0.0)- all IPv4
("::") - all IPv6
if the list is empty it does listen to any IP interface at all
only set at server start


port (integer)
5432
only at server start


max_connections (integer)
100
if you had a standby server set it same or higher or expected queries will not go to the standby server



superuser_reserved_connections (integer)
default is 3 so after 97 connections in your defaults only the superuser can connect
must be less than   max_connections - max_wal_senders.
only at server start



unix_socket_directories (string)
multiple sockets are created by specifing multiple paths seperated by commas,
if your path has whitespace put double quotes around it
in every socket directory theres the socket
.s.PGSQL.nnnn  where nnnn is the port number
a .s.PGSQL.nnnn.lock is also created do not touch



unix_socket_group (string)
    Sets the owning group of the Unix-domain socket. the owning user is the user who started the daemon


unix_socket_permissions (integer)
    sets permisson acces
    default  0777,



bonjour (boolean)
Enables advertising the server's existence via Bonjour

bonjour_name (string)
    Specifies the Bonjour service name.the computer name is used if this is set to empty


tcp_keepalives_idle (integer)
    Specifies the number of seconds of inactivity after which TCP should send a keepalive message to the
client.
default 0


tcp_keepalives_interval (integer)
    Specifies the number of seconds after which a TCP keepalive message that is not acknowledged by
the client should be retransmitted.
default 0

tcp_keepalives_count (integer)
    Specifies the number of TCP keepalives that can be lost before the server's connection to the client is
considered dead
default 0
    


                              ___.---.___
                            .'  (     )  '.
19.3.2.   Authentication    )   /)' '(    )
 Settings                   ',_( ';-;'\_,'
                                  |-|
                                  (-)


authentication_timeout (integer)
    If a would-be client has not completed
the authentication protocol in this much time, the server closes the connection.
in seconds


password_encryption (enum)
    default is md5
    older clients might not support scram

krb_server_keyfile (string)
    Sets the location of the Kerberos server key file
    only in postgresql.conf or psql command line


krb_caseins_users (boolean)
    Sets whether GSSAPI user names should be treated case-insensitively
    only in postgresql.conf or psql command line


db_user_namespace (boolean)
    read about this



                              ___.---.___
                            .'  (     )  '.
19.3.3.   SSL               )   /)' '(    )
 Settings                   ',_( ';-;'\_,'
                                  |-|
                                  (-)

see 18.9 for setting up ssl


ssl (boolean)
    Enables SSL connections.
    only in postgresql.conf or psql command line


ssl_ca_file (string)
    Specifies the name of the file containing the SSL server certificate authority
    only in postgresql.conf or psql command line


ssl_cert_file (string)
    Specifies the name of the file containing the SSL server certificate.
    default server.crt
    only in postgresql.conf or psql command line


ssl_key_file (string)
    Specifies the name of the file containing the SSL server private key
    only in postgresql.conf or psql command line
    default server.key

ssl_ciphers (string)
    Specifies a list of SSL cipher suites that are allowed to be used on secure connections. See the ciphers
manual page in the OpenSSL package for the syntax of this setting and a list of supported values.
    This parameter can only be set in the postgresql.conf file or on the server command line
    default : HIGH:MEDIUM:+3DES:!aNULL.

explnation of default
HIGH
Cipher suites that use ciphers from HIGH group (e.g., AES, Camellia, 3DES)
MEDIUM
Cipher suites that use ciphers from MEDIUM group (e.g., RC4, SEED)
+3DES
The OpenSSL default order for HIGH is problematic because it orders 3DES higher than AES128.
This is wrong because 3DES offers less security than AES128, and it is also much slower. +3DES
reorders it after all other HIGH and MEDIUM ciphers.
!aNULL
Disables anonymous cipher suites that do no authentication. Such cipher suites are vulnerable to
man-in-the-middle attacks and therefore should not be used.




ssl_prefer_server_ciphers (boolean)
    Specifies whether to use the server's SSL cipher preferences, rather than the client's. This parameter
can only be set in the postgresql.conf file or on the server command line. The default is true.



ssl_ecdh_curve (string)
    Specifies the name of the curve to use in ECDH key exchange.
    This parameter can only be set in the postgresql.conf file or on the server command line

ssl_dh_params_file (string)
    Specifies the name of the file containing Diffie-Hellman parameters used for so-called ephemeral
DH family of SSL ciphers

    This parameter can only be set in the postgresql.conf file or on the server command line


ssl_passphrase_command (string)
    Sets an external command to be invoked when a passphrase for decrypting an SSL file such as a private
key needs to be obtained
    This parameter can only be set in the postgresql.conf file or on the server command line.



ssl_passphrase_command_supports_reload (boolean)
    This parameter determines whether the passphrase command set by ssl_passphrase_command
will also be called during a configuration reload if a key file needs a passphrase

    This parameter can only be set in the postgresql.conf file or on the server command line.



                           _    _
                          / \__/ \_____
19.4 resource            /  /  \  \    `\
Consumption              )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'
                





                              ___.---.___
                            .'  (     )  '.
19.4.1.   Memory            )   /)' '(    )
 Consupmtion                ',_( ';-;'\_,'
                                  |-|
                                  (-)


shared_buffers (integer)
Sets the amount of memory the database server uses for shared memory buffers
 be at least 128 kilobytes
 This parameter can only be set at server start.
you need a lot of space expect when u have 1 RAM GB



huge_pages (enum)
Controls whether huge pages are requested for the main shared memory area.
values
try - will try to get them
on- fails if they dont get them
off - dones get them
dont let linux make huge pages without informing postgres



temp_buffers (integer)
Sets the maximum number of temporary buffers used by each database session


max_prepared_transactions (integer)
Sets the maximum number of transactions that can be in the “prepared” state simultaneously (see
PREPARE TRANSACTION)
set a sever start. set to 0 to disable, set to same amnt as max_connections


work_mem (integer)
Specifies the amount of memory to be used by internal sort operations and hash tables before writing
to temporary disk files.


maintenance_work_mem (integer)
Specifies the maximum amount of memory to be used by maintenance operations
dont set this too high

autovacuum_work_mem (integer)
Specifies the maximum amount of memory to be used by each autovacuum worker process.
-1 means use maintenance_work_mem

max_stack_depth (integer)
Specifies the maximum safe depth of the server's execution stack.


dynamic_shared_memory_type (enum)
Specifies the dynamic shared memory implementation that the server should use.



                              ___.---.___
                            .'  (     )  '.
19.4.2. Disk                )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

temp_file_limit (integer)
Specifies the maximum amount of disk space that a process can use for temporary files



                              ___.---.___
                            .'  (     )  '.
19.4.3. Kernel              )   /)' '(    )
Resource Usage              ',_( ';-;'\_,'
                                  |-|
                                  (-)

max_files_per_process (integer)
Sets the maximum number of simultaneously open files allowed to each server subprocess


                              ___.---.___
                            .'  (     )  '.
19.4.4. Cost-based          )   /)' '(    )
Vacuum Delay                ',_( ';-;'\_,'
                                  |-|
                                  (-)

during vaccuum and analyze
when an operation reaches vacuum_cost_limit it will sleep for vacuum_cost_delay



vacuum_cost_delay (integer)
The length of time, in milliseconds, that the process will sleep when the cost limit has been exceeded
0 MEANS ITS DISABLED

vacuum_cost_page_hit (integer)
The estimated cost for vacuuming a buffer found in the shared buffer cache


vacuum_cost_page_miss (integer)
The estimated cost for vacuuming a buffer that has to be read from disk.


vacuum_cost_page_dirty (integer)
The estimated cost charged when vacuum modifies a block that was previously clean


vacuum_cost_limit (integer)
The accumulated cost that will cause the vacuuming process to sleep.

          _    _
         /=\""/=\
        (=(0_0 |=)__
         \_\ _/_/   )   dont enable this
           /_/   _  /\
          |/ |\ || |
             ~ ~  ~


                              ___.---.___
                            .'  (     )  '.
19.4.5. Background Writer   )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

There is a separate server process called the background writer, whose function is to issue writes of “dirty”
(new or modified) shared buffers. but it sometimes does things too much

bgwriter_delay (integer)
Specifies the delay between activity rounds for the background writer

bgwriter_lru_maxpages (integer)
In each round, no more than this many buffers will be written by the background writer


bgwriter_lru_multiplier (floating point)
read about it


bgwriter_flush_after (integer)
Whenever more than bgwriter_flush_after bytes have been written by the background writer,
attempt to force the OS to issue these writes to the underlying storage


                              ___.---.___
                            .'  (     )  '.
19.4.6. Asynchronous        )   /)' '(    )
Behavior                    ',_( ';-;'\_,'
                                  |-|
                                  (-)

effective_io_concurrency (integer)
Sets the number of concurrent disk I/O operations that PostgreSQL expects can be executed simultaneously.

max_worker_processes (integer)
Sets the maximum number of background processes that the system can support


max_parallel_workers_per_gather (integer)
Sets the maximum number of workers that can be started by a single Gather or Gather Merge
node


max_parallel_maintenance_workers (integer)
Sets the maximum number of parallel workers that can be started by a single utility command


max_parallel_workers (integer)
Sets the maximum number of workers that the system can support for parallel operations.

backend_flush_after (integer)
Whenever more than backend_flush_after bytes have been written by a single backend, attempt to force the OS to issue these writes to the underlying storage.


old_snapshot_threshold (integer)
Sets the minimum time that a snapshot can be used without risk of a snapshot too old error
occurring when using the snapshot.



                           _    _
                          / \__/ \_____
19.5 Write Ahead Log     /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


refer to section 30.1 for more info

                              ___.---.___
                            .'  (     )  '.
19.5.1. Settings            )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

wal_level (enum)
wal_level determines how much information is written to the WAL
values: minimal
        replica
        logical



fsync (boolean)
If this parameter is on, the PostgreSQL server will try to make sure that updates are physically written
to disk, by issuing fsync()


synchronous_commit (enum)
Specifies whether transaction commit will wait for WAL records to be written to disk before the
command returns a “success” indication to the client.



wal_sync_method (enum)
Method used for forcing WAL updates out to disk. if sync is on
read here for more info


full_page_writes (boolean)
When this parameter is on, the PostgreSQL server writes the entire content of each disk page to WAL
during the first modification of that page after a checkpoint.



wal_log_hints (boolean)
When this parameter is on, the PostgreSQL server writes the entire content of each disk page to WAL
during the first modification of that page after a checkpoint, even for non-critical modifications of
so-called hint bits


wal_compression (boolean)
When this parameter is on, the PostgreSQL server compresses a full page image written to WAL
when full_page_writes is on or during a base backup.


wal_buffers (integer)
The amount of shared memory used for WAL data that has not yet been written to disk

wal_writer_delay (integer)
Specifies how often the WAL writer flushes WAL


wal_writer_flush_after (integer)
Specifies how often the WAL writer flushes WAL.
they are different check


commit_delay (integer)
commit_delay adds a time delay, measured in microseconds, before a WAL flush is initiated


commit_siblings (integer)
Minimum number of concurrent open transactions to require before performing the commit_delay
delay.



                              ___.---.___
                            .'  (     )  '.
19.5.2. Checkpoints         )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

checkpoint_timeout (integer)
Maximum time between automatic WAL checkpoints, in seconds


checkpoint_completion_target (floating point)
Specifies the target of checkpoint completion, as a fraction of total time between checkpoints


checkpoint_flush_after (integer)
Whenever more than checkpoint_flush_after bytes have been written while performing a
checkpoint, attempt to force the OS to issue these writes to the underlying storage



checkpoint_warning (integer)
Write a message to the server log if checkpoints caused by the filling of WAL segment files happen
closer together than this many seconds (which suggests that max_wal_size ought to be raised).
0 disables this


max_wal_size (integer)
Maximum size to let the WAL grow to between automatic WAL checkpoints.


min_wal_size (integer)
As long as WAL disk usage stays below this setting, old WAL files are always recycled for future use
at a checkpoint, rather than removed.


                              ___.---.___
                            .'  (     )  '.
19.5.3. Archiving           )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

archive_mode (enum)
When archive_mode is enabled, completed WAL segments are sent to archive storage by setting
archive_command.


archive_command (string)
The local shell command to execute to archive a completed WAL file segment.


archive_timeout (integer)
The archive_command is only invoked for completed WAL segments.




                           _    _
                          / \__/ \_____
19.6. Replication        /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'
These settings control the behavior of the built-in streaming replication feature (see Section 26.2 for everything).




                              ___.---.___
                            .'  (     )  '.
19.6.1. Sending Servers     )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)


max_wal_senders (integer)
Specifies the maximum number of concurrent connections from standby servers or streaming base
backup clients (i.e., the maximum number of simultaneously running WAL sender processes).


max_replication_slots (integer)
Specifies the maximum number of replication slots (see Section 26.2.6) that the server can support


wal_keep_segments (integer)
Specifies the minimum number of past log file segments kept in the pg_wal directory, in case a
standby server needs to fetch them for streaming replication.


wal_sender_timeout (integer)
Terminate replication connections that are inactive longer than the specified number of milliseconds


                              ___.---.___
                            .'  (     )  '.
19.6.2. Master Server       )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

These parameters can be set on the master/primary server that is to send replication data to one or more
standby servers


synchronous_standby_names (string)
Specifies a list of standby servers that can support synchronous replication,


vacuum_defer_cleanup_age (integer)
    Specifies the number of transactions by which VACUUM and HOT updates will defer cleanup of dead
row versions.



                              ___.---.___
                            .'  (     )  '.
19.6.3. Standby Servers     )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

                              ___.---.___
                            .'  (     )  '.
19.6.4. Subscribers         )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

These settings control the behavior of a logical replication subscriber.



                           _    _
                          / \__/ \_____
19.7. Query Planning     /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                              ___.---.___
                            .'  (     )  '.
19.7.1. Planner             )   /)' '(    )
Method Configuration         ',_( ';-;'\_,'
                                  |-|
                                  (-)


These configuration parameters provide a crude method of influencing the query plans chosen by the query
optimizer


                           _    _
                          / \__/ \_____
19.8. Error Reporting    /  /  \  \    `\
and Logging              )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'



                              ___.---.___
                            .'  (     )  '.
19.8.1. Where To Log        )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

log_destination (string)
Set this parameter to a list of desired log destinations
separated by commas.


logging_collector (boolean)
This parameter enables the logging collector, which is a background process that captures log messages sent to stderr and redirects them into log files. beter than logging to syslog


          _    _
         /=\""/=\
        (=(0_0 |=)__
         \_\ _/_/   )   The logging collector is designed to never lose messages.
           /_/   _  /\
          |/ |\ || |
             ~ ~  ~

log_directory (string)
When logging_collector is enabled, this parameter determines the directory in which log files
will be created.


log_filename (string)
When logging_collector is enabled, this parameter sets the file names of the created log files


log_file_mode (integer)
On Unix systems this parameter sets the permissions for log files when logging_collector is
enabled.

log_rotation_age (integer)
When logging_collector is enabled, this parameter determines the maximum lifetime of an individual log file

log_rotation_size (integer)
When logging_collector is enabled, this parameter determines the maximum size of an individual log file


log_truncate_on_rotation (boolean)
When logging_collector is enabled, this parameter will cause PostgreSQL to truncate (overwrite), rather than append to, any existing log file of the same name.


syslog_facility (enum)
When logging to syslog is enabled, this parameter determines the syslog “facility” to be used. You
can choose from LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, LOCAL7;


syslog_ident (string)
When logging to syslog is enabled, this parameter determines the program name used to identify
PostgreSQL messages in syslog logs.

syslog_sequence_numbers (boolean)
When logging to syslog and this is on (the default), then each message will be prefixed by an increasing sequence number (such as [2])

syslog_split_messages (boolean)
When logging to syslog is enabled, this parameter determines how messages are delivered to syslog.


event_source (string)
When logging to event log is enabled, this parameter determines the program name used to identify
PostgreSQL messages in the log.


                              ___.---.___
                            .'  (     )  '.
19.8.2. When To Log         )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

log_min_messages (enum)
Controls which message levels are written to the server log.

log_min_error_statement (enum)
Controls which SQL statements that cause an error condition are recorded in the server log


log_min_duration_statement (integer)
Causes the duration of each completed statement to be logged if the statement ran for at least the
specified number of milliseconds.
theres a table check



                              ___.---.___
                            .'  (     )  '.
19.8.3. What To Log        )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

application_name (string)
The application_name can be any string of less than NAMEDATALEN characters (64 characters
in a standard build).


debug_print_parse (boolean)
debug_print_rewritten (boolean)
debug_print_plan (boolean)
These parameters enable various debugging output to be emitted

debug_pretty_print (boolean)
When set indents messages produced by the last 3


log_checkpoints (boolean)
Causes checkpoints and restartpoints to be logged in the server log.


log_connections (boolean)
Causes each attempted connection to the server to be logged, as well as successful completion of client
authentication.


log_disconnections (boolean)
Causes session terminations to be logged.


log_duration (boolean)
Causes the duration of every completed statement to be logged.


log_error_verbosity (enum)
Controls the amount of detail written in the server log for each message that is logged.
values: TERSE
        DEFAULT
        VERBOSE

log_hostname (boolean)
    By default, connection log messages only show the IP address of the connecting host.

log_line_prefix (string)
This is a printf-style string that is output at the beginning of each log line.
refer here if you see something like escaped characters in your string


log_lock_waits (boolean)
Controls whether a log message is produced when a session waits longer than deadlock_timeout to
acquire a lock.


log_statement (enum)
Controls which SQL statements are logged.
read here to undnerstand better

log_replication_commands (boolean)
Causes each replication command to be logged in the server log

log_temp_files (integer)
Controls logging of temporary file names and sizes.


log_timezone (string)
Sets the time zone used for timestamps written in the server log
 See Section 8.5.3



                              ___.---.___
                            .'  (     )  '.
19.8.4. Using CSV-Format    )   /)' '(    )
   Log Output               ',_( ';-;'\_,'
                                  |-|
                                  (-)


Including csvlog in the log_destination list provides a convenient way to import log files into a database table.

Set log_filename and log_rotation_age to provide a consistent, predictable naming scheme
for your log files.

Set log_rotation_size to 0 to disable size-based log rotation,

Set log_truncate_on_rotation to on


                              ___.---.___
                            .'  (     )  '.
19.8.5. Process Title       )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)

cluster_name (string)
Sets the cluster name that appears in the process title for all server processes in this cluster.

update_process_title (boolean)
Enables updating of the process title every time a new SQL command is received by the server.




                           _    _
                          / \__/ \_____
19.9. Run-time           /  /  \  \    `\
 Statistics              )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                              ___.---.___
                            .'  (     )  '.
19.9.1. Query and Index     )   /)' '(    )
 Statistics Collector       ',_( ';-;'\_,'
                                  |-|
                                  (-)


These parameters control server-wide statistics collection features.


track_activities (boolean)
Enables the collection of information on the currently executing command of each session, along with the time when that command began execution


track_activity_query_size (integer)
Specifies the number of bytes reserved to track the currently executing command for each active
session, for the pg_stat_activity.query field.


track_counts (boolean)
Enables collection of statistics on database activity


track_io_timing (boolean)
Enables timing of database I/O calls.


track_functions (enum)
Enables tracking of function call counts and time used


stats_temp_directory (string)
Sets the directory to store temporary statistics data in


                              ___.---.___
                            .'  (     )  '.
19.9.2. Statistics          )   /)' '(    )
 Monitoring                 ',_( ';-;'\_,'
                                  |-|
                                  (-)


log_statement_stats (boolean)
log_parser_stats (boolean)
log_planner_stats (boolean)
log_executor_stats (boolean)


For each query, output performance statistics of the respective module to the server log.




                           _    _
                          / \__/ \_____
19.10. Automatic         /  /  \  \    `\
 Vacuuming               )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

These settings control the behavior of the autovacuum feature. Refer to Section 24.1.6 for more information. Note that many of these settings can be overridden on a per-table basis; see Storage Parameters.



autovacuum (boolean)
    Controls whether the server should run the autovacuum launcher daemon


log_autovacuum_min_duration (integer)
    Causes each action executed by autovacuum to be logged if it ran for at least the specified number of milliseconds.


autovacuum_max_workers (integer)
    Specifies the maximum number of autovacuum processes (other than the autovacuum launcher) that may be running at any one time.


autovacuum_naptime (integer)
    Specifies the minimum delay between autovacuum runs on any given database.


autovacuum_vacuum_threshold (integer)
    Specifies the minimum number of updated or deleted tuples needed to trigger a VACUUM in any one table
    

autovacuum_analyze_threshold (integer)
    Specifies the minimum number of inserted, updated or deleted tuples needed to trigger an ANALYZE in any one table


autovacuum_vacuum_scale_factor (floating point)
    Specifies a fraction of the table size to add to autovacuum_vacuum_threshold when deciding
    whether to trigger a VACUUM


autovacuum_analyze_scale_factor (floating point)
    Specifies a fraction of the table size to add to autovacuum_analyze_threshold when deciding
    whether to trigger an ANALYZE.


autovacuum_freeze_max_age (integer)
    Specifies the maximum age (in transactions) that a table's pg_class.relfrozenxid field can
    attain before a VACUUM operation is forced to prevent transaction ID wraparound within the table.


autovacuum_multixact_freeze_max_age (integer)
    Specifies the maximum age (in multixacts) that a table's pg_class.relminmxid field can attain
    before a VACUUM operation is forced to prevent multixact ID wraparound within the table.


autovacuum_vacuum_cost_delay (integer)
    Specifies the cost delay value that will be used in automatic VACUUM operations.


autovacuum_vacuum_cost_limit (integer)
    Specifies the cost limit value that will be used in automatic VACUUM operations.


                           _    _
                          / \__/ \_____
19.11. Client            /  /  \  \    `\
 Connection Defaults     )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                              ___.---.___
                            .'  (     )  '.
19.11.1. Statement          )   /)' '(    )
  Behavior                  ',_( ';-;'\_,'
                                  |-|
                                  (-)


client_min_messages (enum)
Controls which message levels are sent to the client
 
search_path (string)
This variable specifies the order in which schemas are searched when an object (table, data type,
function, etc.) is referenced by a simple name with no schema specified.


row_security (boolean)
This variable controls whether to raise an error in lieu of applying a row security policy


default_tablespace (string)
This variable specifies the default tablespace in which to create objects (tables and indexes) when a
CREATE command does not explicitly specify a tablespace.


temp_tablespaces (string)
This variable specifies tablespaces in which to create temporary objects (temp tables and indexes on temp tables) when a CREATE command does not explicitly specify a tablespace

check_function_bodies (boolean)
 When set to off, it disables validation of the function body string
during CREATE FUNCTION.


default_transaction_isolation (enum)
Each SQL transaction has an isolation level, which can be either “read uncommitted”, “read committed”, “repeatable read”, or “serializable”. This parameter controls the default isolation level of each
new transaction.


default_transaction_read_only (boolean)
A read-only SQL transaction cannot alter non-temporary tables.


default_transaction_deferrable (boolean)
This parameter controls the default deferrable status of each new transaction.
Consult SET TRANSACTION for more information.


session_replication_role (enum)
Controls firing of replication-related triggers and rules for the current session.


statement_timeout (integer)
Abort any statement that takes more than the specified number of milliseconds, starting from the
time the command arrives at the server from the client.
Setting statement_timeout in postgresql.conf is not recommended because it would affect all sessions.


lock_timeout (integer)
    Abort any statement that waits longer than the specified number of milliseconds while attempting to acquire a lock on a table, index, row, or other database object


idle_in_transaction_session_timeout (integer)
    Terminate any session with an open transaction that has been idle for longer than the specified duration in milliseconds.


vacuum_freeze_table_age (integer)
    VACUUM performs an aggressive scan if the table's pg_class.relfrozenxid field has reached
the age specified by this setting.


vacuum_freeze_min_age (integer)
    Specifies the cutoff age (in transactions) that VACUUM should use to decide whether to freeze row versions while scanning a table.


vacuum_multixact_freeze_table_age (integer)
    VACUUM performs an aggressive scan if the table's pg_class.relminmxid field has reached the
age specified by this setting


vacuum_multixact_freeze_min_age (integer)
    Specifies the cutoff age (in multixacts) that VACUUM should use to decide whether to replace multixact IDs with a newer transaction ID or multixact ID while scanning a table


vacuum_cleanup_index_scale_factor (floating point)
    Specifies the fraction of the total number of heap tuples counted in the previous statistics collection that can be inserted without incurring an index scan at the VACUUM cleanup stage


bytea_output (enum)
    Sets the output format for values of type bytea.


xmlbinary (enum)
    Sets how binary values are to be encoded in XML.


xmloption (enum)
SET XML OPTION { DOCUMENT | CONTENT };
    Sets whether DOCUMENT or CONTENT is implicit when converting between XML and character string
values.


gin_pending_list_limit (integer)
Sets the maximum size of the GIN pending list which is used when fastupdate is enabled



                              ___.---.___
                            .'  (     )  '.
19.11.2. Locale             )   /)' '(    )
  and Formatting            ',_( ';-;'\_,'
                                  |-|
                                  (-)


DateStyle (string)
Sets the display format for date and time values, as well as the rules for interpreting ambiguous date input values.


IntervalStyle (enum)
    Sets the display format for interval values

TimeZone (string)
    Sets the time zone for displaying and interpreting time stamps.


timezone_abbreviations (string)
    Sets the collection of time zone abbreviations that will be accepted by the server for datetime input


extra_float_digits (integer)
    This parameter adjusts the number of digits displayed for floating-point values, including float4, float8, and geometric data types.

client_encoding (string)
    Sets the client-side encoding (character set).


lc_messages (string)
    Sets the language in which messages are displayed.


lc_monetary (string)
    Sets the locale to use for formatting monetary amounts


lc_numeric (string)
    Sets the locale to use for formatting numbers,


lc_time (string)
    Sets the locale to use for formatting dates and times,


default_text_search_config (string)
    Selects the text search configuration that is used by those variants of the text search functions that do not have an explicit argument specifying the configuration


                              ___.---.___
                            .'  (     )  '.
19.11.3. Shared             )   /)' '(    )
  Library Preloading        ',_( ';-;'\_,'
                                  |-|
                                  (-)


Several settings are available for preloading shared libraries into the server, in order to load additional functionality or achieve performance benefits


local_preload_libraries (string)
    This variable specifies one or more shared libraries that are to be preloaded at connection start


session_preload_libraries (string)
    This variable specifies one or more shared libraries that are to be preloaded at connection start.


shared_preload_libraries (string)
    This variable specifies one or more shared libraries to be preloaded at server start.


jit_provider (string)
    This variable is the name of the JIT provider library to be used (see Section 32.4.2). The default is llvmjit



                              ___.---.___
                            .'  (     )  '.
19.11.4. Other Defaults     )   /)' '(    )
                            ',_( ';-;'\_,'
                                  |-|
                                  (-)


dynamic_library_path (string)
    read here



gin_fuzzy_search_limit (integer)
    Soft upper limit of the size of the set returned by GIN index scans.
    For more information see Section 66.5.



                           _    _
                          / \__/ \_____
 19.12. Lock             /  /  \  \    `\
Management               )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


deadlock_timeout (integer)
This is the amount of time, in milliseconds, to wait on a lock before checking to see if there is a deadlock condition


max_locks_per_transaction (integer)
This parameter controls the average number of object locks allocated for
each transaction;


max_pred_locks_per_transaction (integer)
e. This parameter controls the average number of object
locks allocated for each transaction;


max_pred_locks_per_relation (integer)
This controls how many pages or tuples of a single relation can be predicate-locked before the lock is promoted to covering the whole relation


max_pred_locks_per_page (integer)
This controls how many rows on a single page can be predicate-locked before the lock is promoted to covering the whole page


                           _    _
                          / \__/ \_____
19.13. Version and       /  /  \  \    `\
Platform Compatibility   )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'



                              ___.---.___
                            .'  (     )  '.
19.13.1. Previous           )   /)' '(    )
PostgreSQL Versions         ',_( ';-;'\_,'
                                  |-|
                                  (-)



array_nulls (boolean)
    This controls whether the array input parser recognizes unquoted NULL as specifying a null array element.

backslash_quote (enum)
    This controls whether a quote mark can be represented by \' in a string literal


default_with_oids (boolean)
    This controls whether CREATE TABLE and CREATE TABLE AS include an OID column in newly-created tables, if neither WITH OIDS nor WITHOUT OIDS is specified.



escape_string_warning (boolean)
    When on, a warning is issued if a backslash (\) appears in an ordinary string literal ('...' syntax) and standard_conforming_strings is off


lo_compat_privileges (boolean)
    Setting this variable does not disable all security checks related to large objects — only those for which the default behavior has changed in PostgreSQL 9.0.

operator_precedence_warning (boolean)
    When on, the parser will emit a warning for any construct that might have changed meanings since PostgreSQL 9.4 as a result of changes in operator precedence


quote_all_identifiers (boolean)
    When the database generates SQL, force all identifiers to be quoted, even if they are not (currently) keywords


standard_conforming_strings (boolean)
    This controls whether ordinary string literals ('...') treat backslashes literally, as specified in the SQL standard

synchronize_seqscans (boolean)
    This allows sequential scans of large tables to synchronize with each other, so that concurrent scans read the same block at about the same time and hence share the I/O workload

                              ___.---.___
                            .'  (     )  '.
19.13.2. Platform and       )   /)' '(    )
Client Compatibility        ',_( ';-;'\_,'
                                  |-|
                                  (-)


transform_null_equals (boolean)
    read here



                           _    _
                          / \__/ \_____
19.14. Error Handling    /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


exit_on_error (boolean)
If true, any error will terminate the current session


restart_after_crash (boolean)
When set to true, which is the default, PostgreSQL will automatically reinitialize after a backend crash.


data_sync_retry (boolean)
When set to false, which is the default, PostgreSQL will raise a PANIC-level error on failure to flush modified data files to the filesystem. This causes the database server to crash.


                           _    _
                          / \__/ \_____
19.15. Preset Options    /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'
read only

block_size (integer)
Reports the size of a disk block.


data_checksums (boolean)
Reports whether data checksums are enabled for this cluster.


data_directory_mode (integer)
On Unix systems this parameter reports the permissions of the data directory defined by (data_directory) at startup.


debug_assertions (boolean)
Reports whether PostgreSQL has been built with assertions enabled.


integer_datetimes (boolean)
Reports whether PostgreSQL was built with support for 64-bit-integer dates and times.


lc_collate (string)
Reports the locale in which sorting of textual data is done


lc_ctype (string)
    Reports the locale that determines character classifications.


max_function_args (integer)
    Reports the maximum number of function arguments.


max_identifier_length (integer)
    Reports the maximum identifier length.  you can modify this learning how


max_index_keys (integer)
Reports the maximum number of index keys.


segment_size (integer)
    Reports the number of blocks (pages) that can be stored within a file segment


server_encoding (string)
    Reports the database encoding (character set).

server_version (string)
    Reports the version number of the server

server_version_num (integer)
    Reports the version number of the server as an integer


wal_block_size (integer)
    Reports the size of a WAL disk block


wal_segment_size (integer)
    Reports the size of write ahead log segments.


                           _    _
                          / \__/ \_____
19.16. Customized        /  /  \  \    `\
Options                  )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


read here you can do this


                           _    _
                          / \__/ \_____
19.17. Developer         /  /  \  \    `\
Options                  )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


The following parameters are intended for work on the PostgreSQL source code, and in some cases to assist with recovery of severely damaged databases


                           _    _
                          / \__/ \_____
19.18. Short Options     /  /  \  \    `\
Options                  )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


try not to use these


                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
20. Client          |/\    | \_/-'\ \
Authentication      A |   /  ||   /_/
                       |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__


when a client connects to a server it uses the user on the server it wants to connect as
in this case postgres. there are privilige management for each user


                           _    _
                          / \__/ \_____
20.1. The pg_hba.conf    /  /  \  \    `\
 File                    )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


client auth is controlled by this
each line is a record


local
    This record matches connection attempts using Unix-domain sockets. Without a record of this type,
    Unix-domain socket connections are disallowed.


host
    This record matches connection attempts made using TCP/IP. host records match either SSL or nonSSL connection attempts.

hostssl
    TCP/IP only through SSL

hostnossl
    TCP/IP no SSL


database
Specifies which database name(s) this record matches.
    all: match everything
    sameuser: get database = username (postgres comparison syntax lol)
    samerole:user has to have same role as database (also samegroup)
    replication: if a physical replication connection is requested

user
Specifies which database user name(s) this record matches.
    all: all users
    one user: [user]
    group: +[group_name],



        ____
       /.   \__
      /_  \_/  \
     // \  ___ |\ there are no groups in postgresql just roles
        |_| |_|

address
    specifies client machine:hostname,IP addr range or below
    0.0.0.0/0 represents all IPv4
    ::0/0 represents all IPv6 addresses
    all : any IP
    samehost:match server own IP
    samenet:subnets server is connected to

if hostname are specified make sure the resolution is quick


IP-address
IP-mask
    read here

auth-method
    Specifies the authentication method to use when a connection matches this record.

    trust: allow it

    reject: reject it

    scram-sha-256: use this to verify the password

    md5: perform scram-sha-256 or md5 to verify password

    password:Require the client to supply an unencrypted password for authentication

    gss:Use GSSAPI to authenticate the user only on TCP/IP

    sspi: use sspi only on windows

    ident :Obtain the operating system user name of the client by contacting the ident server on the client and check if it matches the requested database user name.
    only TCP/IP
    on local connections peer auth is used instead
    
    peer
        Obtain the client's operating system user name from the operating system and check if it matches the requested database user name. only on local connections

    ldap: auth using LDAP server
    
    radius: auth using RADIUS

    cert: auth using SSL certs
    
    pam: auth using PAM

    bsd: auth using BSD


auth-options
    
        
        ____
       /.   \__
      /_  \_/  \
     // \  ___ |\ its easier to reject connection using CONNECT in SQL than to edit and reload
        |_| |_|    the pg_hba.conf file



        ____
       /.   \__
      /_  \_/  \
     // \  ___ |\ in postgresql in microsoft window the pg_hba.conf gets hot-relloaded
        |_| |_|




after this they go some options



                           _    _
                          / \__/ \_____
20.2. User Name Maps     /  /  \  \    `\
                         )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

sometimes the user of the OS with the \c request is not database user
you need a amap for this problem
known as pg_ident.conf

ident map file contains lines of the general form:

map-name system-username database-username
no limit on mapping

refer here for examples

                           _    _
                          / \__/ \_____
20.3. Authentication     /  /  \  \    `\
 Methods                 )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                           _    _
                          / \__/ \_____
20.4.  Trust             /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                           _    _
                          / \__/ \_____
20.5.  Password          /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

different in how user passwords are stord on the server,
and how there are sent across the network




scram-sha-256
md5
password
The password for each database user is stored in the pg_authid system catalog.
if no password is set up for the user password auth will always fail for the user

to change passwords

CREATE ROLE foo WITH LOGIN PASSWORD 'secret'
ALTER ROLE foo WITH LOGIN PASSWORD 'secret'

to change to scram-sha-256
make sure everyone supports SCRAM then


	add:postgresql.conf
	---------------------------------------------
	---------------------------------------------

	-->

	---------------------------------------------
    password_encryption = 'scramsha-256'
	---------------------------------------------


                           _    _
                          / \__/ \_____
20.6.   GSSAPI           /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

GSSAPI is an industry-standard protocol for secure authentication defined in RFC 2743



                           _    _
                          / \__/ \_____
20.7.    SSPI            /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


                           _    _
                          / \__/ \_____
20.8.    Ident           /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'


 works by obtaining the client's OS  user name from an ident server and using it as the allowed database user name (with an optional user name mapping only on TCP/IP
it only has that map parameter


                           _    _
                          / \__/ \_____
20.9. Peer               /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'
The peer authentication method works by obtaining the client's operating system user name from the kernel
and using it as the allowed database user name (with optional user name mapping).
only for local connections



                           _    _
                          / \__/ \_____
20.10. LDAP               /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

This authentication method operates similarly to password except that it uses LDAP as the password
verification method.
the user must exist in the database


                           _    _
                          / \__/ \_____
20.11. RAIDUS            /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

This authentication method operates similarly to password except that it uses RAIDUS as the password
verification method.
the user must exist in the database


                           _    _
                          / \__/ \_____
20.12. Certificate       /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

 When using this authentication method, the server will require that the client
provide a valid, trusted certificate. No password prompt will be sent to the client. The cn (Common Name)
attribute of the certificate will be compared to the requested database user name, and if they match the login
will be allowed.




                           _    _
                          / \__/ \_____
20.13. PAM               /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'

        ____
       /.   \__
      /_  \_/  \
     // \  ___ |\  If PAM is set up to read /etc/shadow, authentication will fail because the
        |_| |_|    server is started by a non-root user. However, this is not an issue when PAM             is configured to use LDAP or other authentication methods.
  



                           _    _
                          / \__/ \_____
20.14. BSD               /  /  \  \    `\
 Authentication          )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'
READ here


                           _    _
                          / \__/ \_____
20.15.  Authentication   /  /  \  \    `\
    Problems             )  \''/  (     |\
                         `\__)/__/'_\  / `
                            //_|_|~|_|_|
                            ^""'"' ""'"'



FATAL: no pg_hba.conf entry for host "123.123.123.123", user "andym",
 database "testdb"

you contacted the server but it rejects you,
there was no match in pg_hba.conf


FATAL: password authentication failed for user "andym"

incorrect password


FATAL: user "andym" does not exist

what it says


FATAL: database "testdb" does not exist

you need to specify the database name or it think its a db username






                       .-~~-. .--.
                      /      /   "\
                     /    \ |  \   \
21. Database Roles  |/\    | \_/-'\ \
                    A |   /  ||   /_/
                      |__||__||
                     /~~~~~~~~~~\
                    /\_/\_/\_/\_/\
                   /\/ \/ \/ \/ \/\
                __/________________\__

                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.1. Database  )  \''/  (     |\
  Roles         `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'

they are complety seperate from OS users these are actually db users

to create a db role
CREATE ROLE name;   in psql createuser [name]



to remove a db role
DROP ROLE name;     in psql dropuser [name]



to  see all roles in a db cluster
SELECT rolname FROM pg_roles;  in psql \du



                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.2. Role      )  \''/  (     |\
  Attributes    `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'



to create a role with login privilege

CREATE ROLE name LOGIN;
CREATE USER name;


database superuser,

CREATE ROLE name SUPERUSER.


to create a role that can create databases

CREATE ROLE name CREATEDB


to create a role tht can create roles
CREATE ROLE name CREATEROLE

to give a role permission to initiate streaming replication
CREATE ROLE name REPLICATION LOGIN.

password
A password is only significant if the client authentication method requires the user to supply a password when connecting to the database. db passwords are iffrent from OS passwords
CREATE ROLE name PASSWORD 'string'


to modify use
ALTER ROLE


          _    _
         /=\""/=\
        (=(0_0 |=)__
         \_\ _/_/   )   give a role CREATEDB & CREATEROLE and no superuser
           /_/   _  /\  this is an ideal role
          |/ |\ || |
             ~ ~  ~


                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.3. Role      )  \''/  (     |\
  Membership    `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'


to setup a group role

CREATE ROLE joe LOGIN INHERIT;
CREATE ROLE admin NOINHERIT;
CREATE ROLE wheel NOINHERIT;
GRANT admin TO joe;
GRANT wheel TO admin;




joe becomes a part of admin, but cant get wheel because of that noinherit

to changes roles
but they have permission only granted to [user role]


SET ROLE [user role];

to reset roles
SET ROLE joe;
SET ROLE NONE;
RESET ROLE;

even though they are inherited you must use SET ROLE to get the role attributes to manifest


                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.4. Dropping  )  \''/  (     |\
  Roles         `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'


you cant simply DROP ROLE
to drop a role you must move everything away from the role

ALTER TABLE bobs_table OWNER TO alice;


REASSIGN OWNED BY doomed_role TO successor_role;
DROP OWNED BY doomed_role;
-- repeat the above commands in each database of the cluster
DROP ROLE doomed_role;



                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.5. Default   )  \''/  (     |\
  Roles         `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'

to use

GRANT [role in table] TO admin_user;


                  _    _
                 / \__/ \_____
                /  /  \  \    `\
21.6. Function  )  \''/  (     |\
  Security      `\__)/__/'_\  / `
                   //_|_|~|_|_|
                   ^""'"' ""'"'



dont allow people to write write code in programming language postgres uses
they can easily get around the